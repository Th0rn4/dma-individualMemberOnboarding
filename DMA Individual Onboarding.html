<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DMA Individual Onboarding</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet" />
  <style>
    :root {
      --primary-color: #FF4500;
      --primary-hover: #e34300;
      --secondary-color: #0E233B;
      --text-primary: #333333;
      --text-secondary: #4b5563;
      --success-color: #10b981;
      --error-color: #ef4444;
      --warning-color: #f59e0b;
      --info-color: #3b82f6;
      --border-radius: 0.5rem;
    }

    /* Base Styles */
    body {
      position: relative;
      color: var(--text-primary);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica,
        Arial, sans-serif;
      background-color: var(--secondary-color);
      min-height: 100vh;
    }

    /* Thin orange diagonal line from top-left */
    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 200vw;
      height: 200px;
      background-color: var(--primary-color);
      transform: rotate(30deg);
      transform-origin: top left;
      z-index: 0;
    }

    .logo-image {
      max-width: 180px;
    }

    /* Progress Bar Styling */
    .progress-step {
      width: 2rem;
      height: 2rem;
      border-radius: 50%;
      background-color: #f3f4f6;
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      font-weight: 600;
      transition: all 0.3s ease;
      border: 2px solid #f3f4f6;
      z-index: 1;
      margin: 0 0.5rem;
      font-size: 0.875rem;
    }

    .progress-step.active {
      background-color: white;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
      transform: scale(1.1);
      box-shadow: 0 0 0 4px rgba(255, 69, 0, 0.2);
      z-index: 5;
    }

    .progress-step.completed {
      background-color: var(--primary-color);
      color: white;
      border: 2px solid var(--primary-color);
    }

    .progress-step span,
    .progress-step .check-icon {
      transition: opacity 0.3s ease;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    [id^="label"] {
      white-space: nowrap;
      font-size: 0.75rem;
      min-width: 3rem;
      text-align: center;
      position: absolute;
      top: 2.5rem;
      transform: translateX(-50%);
      left: 50%;
    }

    #active-progress-line {
      background-color: var(--primary-color) !important;
      z-index: 0;
    }

    /* Form Controls */
    input[type="text"],
    input[type="date"],
    input[type="email"],
    input[type="tel"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #e5e7eb;
      border-radius: var(--border-radius);
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      font-size: 1rem;
      color: var(--text-primary);
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    input[type="email"]:focus,
    input[type="tel"]:focus,
    input[type="number"]:focus,
    textarea:focus,
    select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(255, 69, 0, 0.2);
      outline: none;
    }

    button {
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
      font-weight: 600;
      cursor: pointer;
      border-radius: var(--border-radius);
      font-size: 1rem;
      height: 44px;
      min-width: 120px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.75rem 1.5rem;
    }

    button:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(255, 69, 0, 0.3);
    }

    button:active {
      transform: translateY(1px);
    }

    button[id="nextBtn"],
    button[id="submitBtn"],
    button.continue {
      background-color: var(--primary-color);
      color: white;
      border: none;
    }

    button[id="nextBtn"]:hover,
    button[id="submitBtn"]:hover,
    button.continue:hover {
      background-color: var(--primary-hover);
    }

    button[id="prevBtn"],
    button.previous,
    button[type="button"]:not([id="nextBtn"]):not([id="submitBtn"]):not(.continue) {
      background-color: white;
      color: var(--primary-color);
      border: 2px solid var(--primary-color);
    }

    button[id="prevBtn"]:hover,
    button.previous:hover,
    button[type="button"]:not([id="nextBtn"]):not([id="submitBtn"]):not(.continue):hover {
      background-color: var(--primary-color);
      color: white;
    }

    /* Form Section Visibility */
    .form-section {
      display: none;
      animation: fadeIn 0.5s ease-in-out;
      transition: all 0.3s ease;
    }

    .form-section.active {
      display: block;
    }

    /* Conditional Fields */
    .conditional-field {
      display: none;
      max-height: 0;
      overflow: hidden;
      transition: all 0.3s ease-in-out;
    }

    .conditional-field.active {
      display: block;
      max-height: 2000px;
      animation: slideDown 0.3s ease-in-out;
    }

    /* Required Fields */
    .required-field::after {
      content: " *";
      color: var(--error-color);
      font-weight: bold;
    }

    /* Radio and Checkbox Styling */
    .radio-group,
    .checkbox-group {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .radio-option,
    .checkbox-option {
      display: flex;
      align-items: center;
    }

    /* Standard radio/checkbox for non-tile styles */
    .simple-radio input[type="radio"],
    .simple-checkbox input[type="checkbox"] {
      width: 1.2rem;
      height: 1.2rem;
      margin-right: 0.5rem;
      accent-color: var(--primary-color);
    }
    
    /* Tile styling for radio buttons */
    .radio-tile {
      display: inline-block;
      width: 100%;
      margin-bottom: 10px;
    }
    
    .radio-tile input[type="radio"] {
      display: none;
    }
    
    .radio-tile label {
      display: block;
      padding: 15px;
      border: 2px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      background-color: #fff;
      height: 100%;
    }
    
    .radio-tile input[type="radio"]:checked + label {
      border-color: var(--primary-color);
      background-color: rgba(255, 69, 0, 0.05);
      box-shadow: 0 0 0 3px rgba(255, 69, 0, 0.2);
    }
    
    .radio-tile-title {
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .radio-tile-description {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }
    
    /* Checkbox tiles */
    .checkbox-tile {
      display: inline-block;
      width: 100%;
      margin-bottom: 10px;
    }
    
    .checkbox-tile input[type="checkbox"] {
      display: none;
    }
    
    .checkbox-tile label {
      display: block;
      padding: 15px;
      border: 2px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s ease;
      background-color: #fff;
      height: 100%;
    }
    
    .checkbox-tile input[type="checkbox"]:checked + label {
      border-color: var(--primary-color);
      background-color: rgba(255, 69, 0, 0.05);
      box-shadow: 0 0 0 3px rgba(255, 69, 0, 0.2);
    }

    /* Radio Card Styling */
    .radio-card {
      border: 1px solid #e5e7eb;
      border-radius: var(--border-radius);
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      padding: 1rem;
      margin-bottom: 0.75rem;
      cursor: pointer;
    }

    .radio-card:hover {
      border-color: var(--primary-color);
      background-color: rgba(255, 69, 0, 0.05);
    }

    .radio-card.selected,
    .radio-card.bg-red-50 {
      border-color: var(--primary-color);
      background-color: rgba(255, 69, 0, 0.05);
    }

    /* Alert Boxes */
    .alert-info {
      background-color: rgba(59, 130, 246, 0.1);
      color: #1e40af;
      padding: 16px;
      border-radius: var(--border-radius);
      margin-bottom: 16px;
      border-left: 4px solid var(--info-color);
      position: relative;
    }

    .alert-warning {
      background-color: rgba(245, 158, 11, 0.1);
      color: #92400e;
      padding: 16px;
      border-radius: var(--border-radius);
      margin-bottom: 16px;
      border-left: 4px solid var(--warning-color);
      position: relative;
      margin-top: 20px;
    }
    
    /* Signature area */
    #signatureCanvas {
      border: 1px solid #ccc;
      border-radius: var(--border-radius);
      width: 100%;
      max-width: 600px;
      height: 200px;
      margin-bottom: 20px;
    }
    
    /* Tax forms styling */
    .tax-form-container {
      border: 2px dashed #ccc;
      padding: 20px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
    }
    
    /* Animations */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .plus-button, .minus-button {
      background-color: var(--secondary-color);
      color: white;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      margin-left: 8px;
      cursor: pointer;
    }
    
    .plus-button:hover, .minus-button:hover {
      opacity: 0.9;
    }
    
    .hidden {
      display: none;
    }

  </style>
</head>

<body>
  <!-- Instructions Page -->
  <div class="min-h-screen p-6">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-8 relative z-10 mb-8" id="instructionsPage">
      <div class="text-center mb-8">
        <h1 class="text-2xl font-semibold text-gray-900">DMA Individual Onboarding - Instructions</h1>
      </div>
      <div class="mb-6">
        <p class="mb-4">
          <strong>Thank you for choosing DMA!</strong> This online form usually takes about <strong>10 minutes</strong> to complete.
          If you're a <strong>non-South African resident</strong>, please note <em>all documents must be certified</em> (e.g. passport, proof of address, proof of banking).
        </p>
        <p class="mb-4">We highly recommend having your documents ready to upload:</p>
        <ul class="list-disc pl-5 mb-4">
          <li class="mb-2"><b>Valid ID/Passport</b> (This can be an ID Card (both sides) or a Passport)</li>
          <li class="mb-2"><b>Proof of address (not older than 3 months)</b> (This can be a Municipal Account in your name, a Lease Agreement or a Utility Bill)</li>
          <li class="mb-2"><b>Proof of banking (not older than 3 months)</b> (This can be a letter from the bank or a bank statement. This must have your name, bank account number and bank name on the same statement)</li>
          <li class="mb-2"><b>Please ensure you have your Tax Number ready</b></li>
        </ul>
        <p>
          For more info, visit our website:
          <a href="https://www.dma.co" target="_blank" rel="noopener" class="text-blue-600 hover:underline">https://www.dma.co</a>
          or email us at
          <a href="mailto:applications@dma.co.za" class="text-blue-600 hover:underline">applications@dma.co.za</a>.
        </p>
      </div>
      <div class="text-center">
        <button type="button" id="startButton" class="bg-orange-600 hover:bg-orange-700 text-white px-8 py-3 rounded-md font-semibold">Start Application</button>
      </div>
    </div>
    
    <!-- Main Form -->
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-md p-8 relative z-10 mb-8 hidden" id="mainFormContainer">
      <!-- Header -->
      <header class="mb-8">
        <div class="flex items-center justify-between mb-6">
          <img class="logo-image" src="https://dialog.tech/XvHmly0f" alt="DMA Logo" />
          <div id="contactus" class="text-sm text-gray-600">
            <div>Need help? Contact us:</div>
            <div>☎ +27 (0)10 201 6300</div>
            <div>
              ✉ <a href="mailto:applications@dma.co.za">applications@dma.co.za</a>
            </div>
          </div>
        </div>

        <h1 class="text-2xl font-semibold text-center mb-2">DMA Individual Onboarding</h1>
        <p id="completeSteps" class="text-center text-gray-600 mb-6">Please complete all required fields to proceed</p>

        <!-- Progress Bar -->
        <div class="relative">
          <!-- Progress Line Background -->
          <div class="absolute top-1/2 left-0 right-0 h-1 bg-gray-200 -translate-y-1/2 rounded-full"></div>

          <!-- Active Progress Line -->
          <div id="active-progress-line"
            class="absolute top-1/2 left-0 h-1 bg-primary rounded-full -translate-y-1/2 transition-all duration-500"
            style="width: 0%"></div>

          <!-- Step Indicators -->
          <div class="relative flex items-center justify-between">
            <!-- Step 1 -->
            <div class="relative flex flex-col items-center">
              <div id="step1" class="progress-step active z-10">
                <span>1</span>
                <svg class="absolute w-4 h-4 text-white opacity-0 check-icon" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd" />
                </svg>
              </div>
              <div id="label1" class="absolute -bottom-8 w-28 text-center text-sm font-medium text-orange-600">
                Account Setup
              </div>
            </div>

            <!-- Step 2 -->
            <div class="relative flex flex-col items-center">
              <div id="step2" class="progress-step z-10">
                <span>2</span>
                <svg class="absolute w-4 h-4 text-white opacity-0 check-icon" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd" />
                </svg>
              </div>
              <div id="label2" class="absolute -bottom-8 w-28 text-center text-sm text-gray-500">
                Personal Details
              </div>
            </div>

            <!-- Step 3 -->
            <div class="relative flex flex-col items-center">
              <div id="step3" class="progress-step z-10">
                <span>3</span>
                <svg class="absolute w-4 h-4 text-white opacity-0 check-icon" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd" />
                </svg>
              </div>
              <div id="label3" class="absolute -bottom-8 w-28 text-center text-sm text-gray-500">
                Employment & Bank
              </div>
            </div>

            <!-- Step 4 -->
            <div class="relative flex flex-col items-center">
              <div id="step4" class="progress-step z-10">
                <span>4</span>
                <svg class="absolute w-4 h-4 text-white opacity-0 check-icon" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd" />
                </svg>
              </div>
              <div id="label4" class="absolute -bottom-8 w-28 text-center text-sm text-gray-500">
                Trading Experience
              </div>
            </div>

            <!-- Step 5 -->
            <div class="relative flex flex-col items-center">
              <div id="step5" class="progress-step z-10">
                <span>5</span>
                <svg class="absolute w-4 h-4 text-white opacity-0 check-icon" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd" />
                </svg>
              </div>
              <div id="label5" class="absolute -bottom-8 w-28 text-center text-sm text-gray-500">
                Dividends Tax
              </div>
            </div>

            <!-- Step 6 -->
            <div class="relative flex flex-col items-center">
              <div id="step6" class="progress-step z-10">
                <span>6</span>
                <svg class="absolute w-4 h-4 text-white opacity-0 check-icon" xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd" />
                </svg>
              </div>
              <div id="label6" class="absolute -bottom-8 w-28 text-center text-sm text-gray-500">
                Declarations
              </div>
            </div>
          </div>
        </div>
      </header>

      <form id="dmaForm">
        <!-- Step 1: Account Setup -->
        <section id="section1" class="form-section active">
          <h2 class="text-xl font-semibold mb-6">Account Setup</h2>
          
          <div class="mb-6">
            <label class="block text-gray-700 font-medium mb-2 required-field">
              Are you a South African Resident?
            </label>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="radio-tile">
                <input type="radio" name="residency" id="residencyYes" value="sa" required>
                <label for="residencyYes">
                  <div class="radio-tile-title">Yes</div>
                  <div class="radio-tile-description">I am a South African resident</div>
                </label>
              </div>
              <div class="radio-tile">
                <input type="radio" name="residency" id="residencyNo" value="foreign" required>
                <label for="residencyNo">
                  <div class="radio-tile-title">No</div>
                  <div class="radio-tile-description">I am not a South African resident</div>
                </label>
              </div>
            </div>
          </div>
          
          <div class="mb-6" id="usCitizenSection">
            <label class="block text-gray-700 font-medium mb-2 required-field">
              Are you a tax liable US citizen?
            </label>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div class="radio-tile">
                <input type="radio" name="usCitizen" id="usCitizenYes" value="yes" required>
                <label for="usCitizenYes">
                  <div class="radio-tile-title">Yes</div>
                  <div class="radio-tile-description">I am a tax liable US citizen</div>
                </label>
              </div>
              <div class="radio-tile">
                <input type="radio" name="usCitizen" id="usCitizenNo" value="no" required>
                <label for="usCitizenNo">
                  <div class="radio-tile-title">No</div>
                  <div class="radio-tile-description">I am not a tax liable US citizen</div>
                </label>
              </div>
            </div>
            <div id="usCitizenWarning" class="mt-2 text-red-600 hidden">
              We regret to inform you: Since you are a US tax resident, we cannot accept your application at this time.
            </div>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-group">
              <label for="accountType" class="block text-gray-700 font-medium mb-2 required-field">Account Type</label>
              <select name="accountType" id="accountType" class="w-full" required>
                <option value="" disabled selected>Select an option</option>
                <!-- Options dynamically populated by JS -->
              </select>
            </div>
            
            <div class="form-group">
              <label for="baseCurrencySelect" id="baseCurrencyLabel" class="block text-gray-700 font-medium mb-2">Main Account Currency</label>
              <select name="baseCurrency" id="baseCurrencySelect" class="w-full">
                <option value="" disabled selected>Select an option</option>
                <!-- Options dynamically populated by JS -->
              </select>
            </div>
          </div>
        </section>

        <!-- Step 2: Personal Details -->
        <section id="section2" class="form-section">
          <h2 class="text-xl font-semibold mb-6">Personal Details</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-group">
              <label for="title" class="block text-gray-700 font-medium mb-2 required-field">Title</label>
              <select name="title" id="title" class="w-full" required>
                <option value="">Select</option>
                <option value="Mr">Mr</option>
                <option value="Mrs">Mrs</option>
                <option value="Miss">Miss</option>
                <option value="Ms">Ms</option>
                <option value="Dr">Dr</option>
                <option value="Other">Other</option>
              </select>
              <div id="otherTitleDiv" class="mt-2 hidden">
                <label for="otherTitle" class="block text-gray-700 font-medium mb-2">Please specify:</label>
                <input type="text" name="otherTitle" id="otherTitle" class="w-full" placeholder="Specify your title">
              </div>
            </div>
            
            <div class="form-group">
              <label for="forenames" class="block text-gray-700 font-medium mb-2 required-field">First Name</label>
              <input type="text" name="forenames" id="forenames" class="w-full" required placeholder="Enter your first name">
            </div>
            
            <div class="form-group">
              <label for="surname" class="block text-gray-700 font-medium mb-2 required-field">Surname</label>
              <input type="text" name="surname" id="surname" class="w-full" required placeholder="Enter your surname">
            </div>
            
            <div class="form-group">
              <label for="dob" class="block text-gray-700 font-medium mb-2 required-field">Date of Birth</label>
              <input type="date" name="dob" id="dob" class="w-full" required placeholder="YYYY-MM-DD">
            </div>
            
            <div class="form-group">
              <label for="countryOfBirth" class="block text-gray-700 font-medium mb-2 required-field">Country of Birth</label>
              <select name="countryOfBirth" id="countryOfBirth" class="w-full" required>
                <option value="">Select Country</option>
                <option value="South Africa">South Africa</option>
                <option value="United Kingdom">United Kingdom</option>
                <option value="USA">USA</option>
                <option value="Netherlands">Netherlands</option>
                <!-- More countries will be added -->
              </select>
            </div>
            
            <div class="form-group">
              <label for="cityOfBirth" class="block text-gray-700 font-medium mb-2 required-field">Town/City of Birth</label>
              <input type="text" name="cityOfBirth" id="cityOfBirth" class="w-full" required placeholder="Enter your town/city of birth">
            </div>
            
            <div class="form-group">
              <label for="mobileNumber" class="block text-gray-700 font-medium mb-2 required-field">Mobile Number</label>
              <div class="flex gap-2">
                <select name="countryCode" class="w-1/4">
                  <option value="+27">+27</option>
                  <option value="+1">+1</option>
                  <option value="+44">+44</option>
                  <option value="+61">+61</option>
                  <option value="+91">+91</option>
                </select>
                <input type="tel" name="mobileNumber" id="mobileNumber" class="w-3/4" required placeholder="Enter your mobile number" pattern="[0-9]+">
              </div>
            </div>
            
            <div class="form-group">
              <label for="email" class="block text-gray-700 font-medium mb-2 required-field">Email Address</label>
              <input type="email" name="email" id="email" class="w-full" required placeholder="Enter your email address">
            </div>
          </div>
          
          <div class="mt-6">
            <h3 class="text-lg font-medium mb-4">Identification</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="form-group">
                <label for="idType" class="block text-gray-700 font-medium mb-2 required-field">ID Type</label>
                <select name="idType" id="idType" class="w-full" required>
                  <option value="">Select ID Type</option>
                  <option value="Drivers">Driver's License</option>
                  <option value="ID Document">ID Document</option>
                  <option value="Passport">Passport</option>
                </select>
              </div>
              
              <div class="form-group">
                <label for="idNumber" class="block text-gray-700 font-medium mb-2 required-field">ID Document Number</label>
                <input type="text" name="idNumber" id="idNumber" class="w-full" required placeholder="Enter your ID document number">
              </div>
              
              <div class="form-group col-span-2">
                <label for="idUpload" class="block text-gray-700 font-medium mb-2 required-field">Upload your ID Document</label>
                <p class="text-sm text-gray-500 mb-2">Upload valid passport or both sides of an ID card (certified if foreign)</p>
                <input type="file" name="idUpload" id="idUpload" accept=".pdf, image/*" required>
              </div>
            </div>
          </div>
          
          <div class="mt-6">
            <h3 class="text-lg font-medium mb-4">Tax & Nationality</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="form-group">
                <label for="taxNumberPersonal" class="block text-gray-700 font-medium mb-2 required-field">Tax Number</label>
                <input type="text" name="taxNumberPersonal" id="taxNumberPersonal" class="w-full" required placeholder="Enter your tax number">
              </div>
              
              <div class="form-group">
                <label for="nationality" class="block text-gray-700 font-medium mb-2 required-field">Nationality</label>
                <select name="nationality" id="nationality" class="w-full" required>
                  <option value="">Select Nationality</option>
                  <option value="South Africa">South Africa</option>
                  <option value="United Kingdom">United Kingdom</option>
                  <option value="USA">USA</option>
                  <option value="Netherlands">Netherlands</option>
                  <!-- More nationalities will be added -->
                </select>
              </div>
            </div>
            
            <div class="mt-4">
              <label class="block text-gray-700 font-medium mb-2 required-field">
                Do you have multiple nationalities?
              </label>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="radio-tile">
                  <input type="radio" name="multipleNationalities" id="multipleNationalitiesYes" value="yes" required>
                  <label for="multipleNationalitiesYes">
                    <div class="radio-tile-title">Yes</div>
                    <div class="radio-tile-description">I have citizenship in more than one country</div>
                  </label>
                </div>
                <div class="radio-tile">
                  <input type="radio" name="multipleNationalities" id="multipleNationalitiesNo" value="no" required>
                  <label for="multipleNationalitiesNo">
                    <div class="radio-tile-title">No</div>
                    <div class="radio-tile-description">I only have one citizenship</div>
                  </label>
                </div>
              </div>
            </div>
            
            <!-- Container for additional nationality dropdowns -->
            <div id="multipleNationalitiesContainer" class="mt-4 hidden">
              <label class="block text-gray-700 font-medium mb-2">If yes, please select other nationalities</label>
              <div id="nationality-dropdowns">
                <div class="nationality-item flex items-center mb-2">
                  <select name="nationalities[]" class="nationality-select w-full">
                    <option value="">Select a nationality</option>
                    <option value="South Africa">South Africa</option>
                    <option value="USA">USA</option>
                    <option value="United Kingdom">United Kingdom</option>
                    <option value="Canada">Canada</option>
                    <option value="Australia">Australia</option>
                  </select>
                  <button type="button" class="plus-button ml-2">+</button>
                </div>
              </div>
            </div>
            
            <div class="mt-4">
              <label class="block text-gray-700 font-medium mb-2">Do you have a tax residency in another country?</label>
              <div id="country-dropdowns">
                <div class="country-item flex items-center mb-2">
                  <select name="countries[]" class="country-select w-full">
                    <option value="">Select a country</option>
                    <option value="USA">USA</option>
                    <option value="Canada">Canada</option>
                    <option value="United Kingdom">United Kingdom</option>
                    <option value="South Africa">South Africa</option>
                    <option value="Australia">Australia</option>
                  </select>
                  <button type="button" class="plus-button ml-2">+</button>
                </div>
              </div>
            </div>
            
            <div class="form-group mt-4">
              <label for="additionalTaxNumber" class="block text-gray-700 font-medium mb-2">Additional Tax Number (if applicable)</label>
              <input type="text" name="additionalTaxNumber" id="additionalTaxNumber" class="w-full" placeholder="Enter additional tax number if applicable">
            </div>
          </div>
          
          <div class="mt-6">
            <h3 class="text-lg font-medium mb-4">Current Residential Address</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="form-group">
                <label for="currentFlatNo" class="block text-gray-700 font-medium mb-2">Flat No/Building Name</label>
                <input type="text" name="currentFlatNo" id="currentFlatNo" class="w-full" placeholder="Enter flat number or building name">
              </div>
              
              <div class="form-group">
                <label for="currentStreetNo" class="block text-gray-700 font-medium mb-2 required-field">House/Street No.</label>
                <input type="text" name="currentStreetNo" id="currentStreetNo" class="w-full" required placeholder="Enter house or street number">
              </div>
              
              <div class="form-group">
                <label for="currentTownCity" class="block text-gray-700 font-medium mb-2 required-field">Town/City</label>
                <input type="text" name="currentTownCity" id="currentTownCity" class="w-full" required placeholder="Enter town or city">
              </div>
              
              <div class="form-group">
                <label for="currentProvince" class="block text-gray-700 font-medium mb-2">Province</label>
                <input type="text" name="currentProvince" id="currentProvince" class="w-full" placeholder="Enter province">
              </div>
              
              <div class="form-group">
                <label for="currentPostalCode" class="block text-gray-700 font-medium mb-2 required-field">Postal Code</label>
                <input type="text" name="currentPostalCode" id="currentPostalCode" class="w-full" required placeholder="Enter postal code">
              </div>
              
              <div class="form-group">
                <label for="currentCountry" class="block text-gray-700 font-medium mb-2 required-field">Country</label>
                <input type="text" name="currentCountry" id="currentCountry" class="w-full" required placeholder="Enter country">
              </div>
            </div>
            
            <div class="form-group mt-4">
              <label for="resAddressDocs" class="block text-gray-700 font-medium mb-2 required-field">Upload Supporting Document for Residential Address</label>
              <p class="text-sm text-gray-500 mb-2">Upload bank statement, municipal account, or lease agreement (certified if foreign)</p>
              <input type="file" name="resAddressDocs" id="resAddressDocs" accept=".pdf, image/*" required>
            </div>
            
            <div class="mt-4">
              <label class="block text-gray-700 font-medium mb-2 required-field">Have you been at your current address for 3 or more years?</label>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="radio-tile">
                  <input type="radio" name="addressDuration" id="addressDurationYes" value="yes" required>
                  <label for="addressDurationYes">
                    <div class="radio-tile-title">Yes</div>
                    <div class="radio-tile-description">I have lived at my current address for 3+ years</div>
                  </label>
                </div>
                <div class="radio-tile">
                  <input type="radio" name="addressDuration" id="addressDurationNo" value="no" required>
                  <label for="addressDurationNo">
                    <div class="radio-tile-title">No</div>
                    <div class="radio-tile-description">I have lived at my current address for less than 3 years</div>
                  </label>
                </div>
              </div>
            </div>
            
            <!-- Previous Address (Initially Hidden) -->
            <div id="previousAddressDiv" class="mt-4 hidden">
              <h3 class="text-lg font-medium mb-4">Previous Residential Address</h3>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                  <label for="prevFlatNo" class="block text-gray-700 font-medium mb-2">Flat No/Building Name</label>
                  <input type="text" name="prevFlatNo" id="prevFlatNo" class="w-full" placeholder="Enter previous flat number or building name">
                </div>
                
                <div class="form-group">
                  <label for="prevStreetNo" class="block text-gray-700 font-medium mb-2">House/Street No.</label>
                  <input type="text" name="prevStreetNo" id="prevStreetNo" class="w-full" placeholder="Enter previous house or street number">
                </div>
                
                <div class="form-group">
                  <label for="prevTownCity" class="block text-gray-700 font-medium mb-2">Town/City</label>
                  <input type="text" name="prevTownCity" id="prevTownCity" class="w-full" placeholder="Enter previous town or city">
                </div>
                
                <div class="form-group">
                  <label for="prevProvince" class="block text-gray-700 font-medium mb-2">Province</label>
                  <input type="text" name="prevProvince" id="prevProvince" class="w-full" placeholder="Enter previous province">
                </div>
                
                <div class="form-group">
                  <label for="prevPostalCode" class="block text-gray-700 font-medium mb-2">Postal Code</label>
                  <input type="text" name="prevPostalCode" id="prevPostalCode" class="w-full" placeholder="Enter previous postal code">
                </div>
                
                <div class="form-group">
                  <label for="prevCountry" class="block text-gray-700 font-medium mb-2">Country</label>
                  <input type="text" name="prevCountry" id="prevCountry" class="w-full" placeholder="Enter previous country">
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Step 3: Employment & Bank Details -->
        <section id="section3" class="form-section">
          <h2 class="text-xl font-semibold mb-6">Employment & Bank Details</h2>
          
          <!-- Employment Details -->
          <div class="mb-8">
            <h3 class="text-lg font-medium mb-4">Employment Details</h3>
            
            <div class="mb-4">
              <label class="block text-gray-700 font-medium mb-2 required-field">Source(s) of Funds (select all that apply)</label>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="checkbox-option">
                  <input type="checkbox" name="fundSource" id="employmentCheckbox" value="employment">
                  <label for="employmentCheckbox">Employment</label>
                </div>
                <div class="checkbox-option">
                  <input type="checkbox" name="fundSource" id="pensionCheckbox" value="pension">
                  <label for="pensionCheckbox">Pension</label>
                </div>
                <div class="checkbox-option">
                  <input type="checkbox" name="fundSource" id="inheritanceCheckbox" value="inheritance">
                  <label for="inheritanceCheckbox">Inheritance</label>
                </div>
                <div class="checkbox-option">
                  <input type="checkbox" name="fundSource" id="selfEmployedCheckbox" value="selfEmployed">
                  <label for="selfEmployedCheckbox">Self-employed</label>
                </div>
                <div class="checkbox-option">
                  <input type="checkbox" name="fundSource" id="savingsCheckbox" value="savings">
                  <label for="savingsCheckbox">Savings & Investments</label>
                </div>
                <div class="checkbox-option">
                  <input type="checkbox" name="fundSource" id="otherFundCheckbox" value="other">
                  <label for="otherFundCheckbox">Other</label>
                </div>
              </div>
            </div>
            
            <!-- Employment Details (Initially Hidden) -->
            <div id="employmentDetails" class="bg-gray-50 p-4 rounded-md hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                  <label for="employerName" class="block text-gray-700 font-medium mb-2 required-field">Employer Name</label>
                  <input type="text" name="employerName" id="employerName" class="w-full" required placeholder="Enter your employer name">
                </div>
                <div class="form-group">
                  <label for="jobTitle" class="block text-gray-700 font-medium mb-2 required-field">Job Title</label>
                  <input type="text" name="jobTitle" id="jobTitle" class="w-full" required placeholder="Enter your job title">
                </div>
              </div>
            </div>
            
            <!-- Self-Employed Details (Initially Hidden) -->
            <div id="selfEmployedDetails" class="bg-gray-50 p-4 rounded-md mt-4 hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                  <label for="businessName" class="block text-gray-700 font-medium mb-2 required-field">Business Name</label>
                  <input type="text" name="businessName" id="businessName" class="w-full" required placeholder="Enter your business name">
                </div>
                <div class="form-group">
                  <label for="natureOfBusiness" class="block text-gray-700 font-medium mb-2 required-field">Nature of Business</label>
                  <input type="text" name="natureOfBusiness" id="natureOfBusiness" class="w-full" required placeholder="Describe your business">
                </div>
                <div class="form-group">
                  <label for="annualTurnover" class="block text-gray-700 font-medium mb-2 required-field">Estimated Annual Turnover</label>
                  <input type="number" name="annualTurnover" id="annualTurnover" class="w-full" required value="0" placeholder="Enter estimated annual turnover">
                </div>
              </div>
            </div>
            
            <!-- Other Fund Details (Initially Hidden) -->
            <div id="otherFundDetails" class="bg-gray-50 p-4 rounded-md mt-4 hidden">
              <div class="form-group">
                <label for="otherFundDetailsText" class="block text-gray-700 font-medium mb-2 required-field">Other Source Details</label>
                <input type="text" name="otherFundDetailsText" id="otherFundDetailsText" class="w-full" required placeholder="Enter other source details">
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
              <div class="form-group">
                <label for="monthlyIncome" class="block text-gray-700 font-medium mb-2 required-field">Monthly Income after Tax</label>
                <input type="number" name="monthlyIncome" id="monthlyIncome" class="w-full" required value="0" placeholder="Enter your monthly income after tax">
              </div>
              <div class="form-group">
                <label for="monthlyOutgoings" class="block text-gray-700 font-medium mb-2 required-field">Monthly Outgoings</label>
                <input type="number" name="monthlyOutgoings" id="monthlyOutgoings" class="w-full" required value="0" placeholder="Enter your monthly outgoings">
              </div>
              <div class="form-group">
                <label for="savingsValue" class="block text-gray-700 font-medium mb-2 required-field">Value of Savings & Investments</label>
                <input type="number" name="savingsValue" id="savingsValue" class="w-full" required value="0" placeholder="Enter value of savings & investments">
              </div>
              <div class="form-group">
                <label for="dmaInvestment" class="block text-gray-700 font-medium mb-2 required-field">Planned Investment with DMA (Next 3 Years)</label>
                <input type="number" name="dmaInvestment" id="dmaInvestment" class="w-full" required value="0" placeholder="Enter planned DMA investment">
              </div>
            </div>
          </div>
          
          <!-- Bank Details -->
          <div class="mt-8">
            <h3 class="text-lg font-medium mb-4">Bank Details</h3>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="form-group">
                <label for="account_holder" class="block text-gray-700 font-medium mb-2 required-field">Account Holder Name</label>
                <input type="text" name="account_holder" id="account_holder" class="w-full" required placeholder="e.g. John Smith">
              </div>
              <div class="form-group">
                <label for="bank_name" class="block text-gray-700 font-medium mb-2 required-field">Bank Name</label>
                <input type="text" name="bank_name" id="bank_name" class="w-full" required placeholder="e.g. ABC Bank">
              </div>
              <div class="form-group">
                <label for="bank_account_type" class="block text-gray-700 font-medium mb-2 required-field">Bank Account Type</label>
                <select name="bank_account_type" id="bank_account_type" class="w-full" required>
                  <option value="">-- Please Select --</option>
                  <option value="checking">Checking</option>
                  <option value="savings">Savings</option>
                  <option value="business">Business</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="form-group">
                <label for="account_number" class="block text-gray-700 font-medium mb-2 required-field">Account Number/IBAN</label>
                <input type="text" name="account_number" id="account_number" class="w-full" required placeholder="e.g. GB29NWBK...">
              </div>
              <div class="form-group">
                <label for="branch_code" class="block text-gray-700 font-medium mb-2 required-field">Branch/Sort Code</label>
                <input type="text" name="branch_code" id="branch_code" class="w-full" required placeholder="e.g. 60-83-71">
              </div>
              <div class="form-group">
                <label for="swift_code" class="block text-gray-700 font-medium mb-2 required-field">Swift/BIC Code</label>
                <input type="text" name="swift_code" id="swift_code" class="w-full" required placeholder="e.g. ABCDGB2L">
              </div>
              <div class="form-group col-span-2">
                <label for="proof_upload" class="block text-gray-700 font-medium mb-2 required-field">Proof of Bank Account</label>
                <p class="text-sm text-gray-500 mb-2">Upload bank statement or letter showing bank name and account number, in your details</p>
                <input type="file" name="proof_upload" id="proof_upload" accept=".pdf, image/*" required>
              </div>
            </div>
            
            <div class="bg-yellow-50 p-4 border-l-4 border-yellow-400 mt-6">
              <p class="text-yellow-800 font-medium">Important Notice: DMA does not accept or make 3rd party payments. Third party deposits will be returned.</p>
            </div>
          </div>
        </section>

        <!-- Step 4: Trading Experience -->
        <section id="section4" class="form-section">
          <h2 class="text-xl font-semibold mb-6">Trading Experience</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="form-group">
              <label class="block text-gray-700 font-medium mb-2 required-field">Have you ever traded financial products before?</label>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" name="financialProducts" id="financialProductsYes" value="yes" required>
                  <label for="financialProductsYes">Yes</label>
                </div>
                <div class="radio-option">
                  <input type="radio" name="financialProducts" id="financialProductsNo" value="no" required>
                  <label for="financialProductsNo">No</label>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label class="block text-gray-700 font-medium mb-2 required-field">Do you have an industry‐recognised qualification for trading?</label>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" name="recognisedQual" id="recognisedQualYes" value="yes" required>
                  <label for="recognisedQualYes">Yes</label>
                </div>
                <div class="radio-option">
                  <input type="radio" name="recognisedQual" id="recognisedQualNo" value="no" required>
                  <label for="recognisedQualNo">No</label>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label class="block text-gray-700 font-medium mb-2 required-field">Have you worked in the financial sector (at least one year)?</label>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" name="hasExperience" id="hasExperienceYes" value="yes" required>
                  <label for="hasExperienceYes">Yes</label>
                </div>
                <div class="radio-option">
                  <input type="radio" name="hasExperience" id="hasExperienceNo" value="no" required>
                  <label for="hasExperienceNo">No</label>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label class="block text-gray-700 font-medium mb-2 required-field">Have you ever traded derivative products (CFDs, Futures, Options)?</label>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" name="hasderivatives" id="hasderivativesYes" value="yes" required>
                  <label for="hasderivativesYes">Yes</label>
                </div>
                <div class="radio-option">
                  <input type="radio" name="hasderivatives" id="hasderivativesNo" value="no" required>
                  <label for="hasderivativesNo">No</label>
                </div>
              </div>
            </div>
            
            <div class="form-group">
              <label for="tradingduration" class="block text-gray-700 font-medium mb-2 required-field">How long have you continuously traded financial products?</label>
              <select name="tradingduration" id="tradingduration" class="w-full" required>
                <option value="">-- Select --</option>
                <option value="less1">Less than 1 year</option>
                <option value="1-2">1 - 2 years</option>
                <option value="2-5">2 - 5 years</option>
                <option value="5-10">5 - 10 years</option>
                <option value="10plus">More than 10 years</option>
              </select>
            </div>
          </div>
          
          <div class="mt-8">
            <h3 class="text-lg font-medium mb-4">Trading Activity (Last 12 Months)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="form-group">
                <label for="tradefx" class="block text-gray-700 font-medium mb-2">FX Rolling Spot</label>
                <input type="number" name="tradefx" id="tradefx" class="w-full" value="0" placeholder="Enter amount">
              </div>
              <div class="form-group">
                <label for="tradeoptions" class="block text-gray-700 font-medium mb-2">Options & Futures</label>
                <input type="number" name="tradeoptions" id="tradeoptions" class="w-full" value="0" placeholder="Enter amount">
              </div>
              <div class="form-group">
                <label for="tradecfds" class="block text-gray-700 font-medium mb-2">CFDs</label>
                <input type="number" name="tradecfds" id="tradecfds" class="w-full" value="0" placeholder="Enter amount">
              </div>
              <div class="form-group">
                <label for="tradespreads" class="block text-gray-700 font-medium mb-2">Financial Spread Bets</label>
                <input type="number" name="tradespreads" id="tradespreads" class="w-full" value="0" placeholder="Enter amount">
              </div>
              <div class="form-group">
                <label for="tradeshares" class="block text-gray-700 font-medium mb-2">Shares & ETF's</label>
                <input type="number" name="tradeshares" id="tradeshares" class="w-full" value="0" placeholder="Enter amount">
              </div>
              <div class="form-group">
                <label for="trademutualFunds" class="block text-gray-700 font-medium mb-2">Mutual Funds</label>
                <input type="number" name="trademutualFunds" id="trademutualFunds" class="w-full" value="0" placeholder="Enter amount">
              </div>
              <div class="form-group">
                <label for="tradebonds" class="block text-gray-700 font-medium mb-2">Bonds/Gilts</label>
                <input type="number" name="tradebonds" id="tradebonds" class="w-full" value="0" placeholder="Enter amount">
              </div>
            </div>
          </div>
        </section>
        
        <!-- Step 5: Dividends Tax -->
        <section id="section5" class="form-section">
          <h2 class="text-xl font-semibold mb-6">Dividends Tax</h2>
          
          <p class="mb-6">
            Please complete the Dividends Tax form below. South African residents will complete the DTD form, while non–South Africans will complete the W‑8BEN form.
          </p>
          
          <!-- DTD Form Container (for South African residents) -->
          <div id="dtd-form-container" class="tax-form-container hidden">
            <h3 class="text-lg font-semibold mb-4">FORM DTD (EX): Dividends Tax</h3>
            <p class="font-medium mb-2">Declaration & Undertaking for dividend tax exemption.</p>
            <p class="italic mb-4">Complete if applicable (seek independent tax advice).</p>
            
            <div class="bg-orange-50 border-l-4 border-orange-500 p-4 mb-6">
              <p class="font-bold">NOTES ON COMPLETION:</p>
              <ul class="list-disc pl-6 mt-2">
                <li>This form is to be completed by the beneficial owner for tax exemption.</li>
                <li>Submission must occur within the required period.</li>
                <li><strong>Non-South African residents should not complete this form.</strong></li>
              </ul>
            </div>
            
            <div class="mb-6">
              <h4 class="text-md font-medium mb-3">PART A: Withholding Agent</h4>
              <p class="italic mb-2">(Pre-populated)</p>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="registeredName" class="block text-gray-700 mb-1">Registered Name:</label>
                  <input type="text" id="registeredName" name="registeredName" value="SCM DMA (Pty) Ltd." class="w-full bg-gray-100" readonly>
                </div>
                <div class="form-group">
                  <label for="taxReferenceNumber" class="block text-gray-700 mb-1">Dividends tax reference #:</label>
                  <input type="text" id="taxReferenceNumber" name="taxReferenceNumber" value="(pre-populated)" class="w-full bg-gray-100" readonly>
                </div>
                <div class="form-group col-span-2">
                  <label for="withholdingAddress" class="block text-gray-700 mb-1">Address:</label>
                  <textarea id="withholdingAddress" name="withholdingAddress" rows="3" class="w-full bg-gray-100" readonly>48 7th Ave
Parktown North
Johannesburg
2193</textarea>
                </div>
                <div class="form-group">
                  <label for="withholdingTelephone" class="block text-gray-700 mb-1">Telephone #:</label>
                  <input type="text" id="withholdingTelephone" name="withholdingTelephone" value="+27 (0)10 201 6300" class="w-full bg-gray-100" readonly>
                </div>
                <div class="form-group">
                  <label for="withholdingEmail" class="block text-gray-700 mb-1">E-mail:</label>
                  <input type="text" id="withholdingEmail" name="withholdingEmail" value="applications@dma.co.za" class="w-full bg-gray-100" readonly>
                </div>
              </div>
            </div>
            
            <div class="mb-6">
              <h4 class="text-md font-medium mb-3">PART B: Beneficial Owner</h4>
              <p class="italic mb-2">(Complete by the dividend recipient)</p>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="form-group">
                  <label for="fullName" class="block text-gray-700 mb-1 required-field">Full Name / Registered Name:</label>
                  <input type="text" id="fullName" name="fullName" class="w-full" required>
                </div>
                <div class="form-group">
                  <label for="entityNumber" class="block text-gray-700 mb-1">Entity number (if applicable):</label>
                  <input type="text" id="entityNumber" name="entityNumber" class="w-full">
                </div>
              </div>
              
              <div class="mt-4">
                <p class="font-medium mb-2">Nature of person/entity:</p>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3 ml-4">
                  <div class="radio-option">
                    <input type="radio" id="natureIndividual" name="nature" value="individual">
                    <label for="natureIndividual">Individual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="natureListedCompany" name="nature" value="listedCompany">
                    <label for="natureListedCompany">Listed Company</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="natureUnlistedCompany" name="nature" value="unlistedCompany">
                    <label for="natureUnlistedCompany">Unlisted Company</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="natureTrust" name="nature" value="trust">
                    <label for="natureTrust">Trust</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="natureRsaGovernment" name="nature" value="rsaGovernment">
                    <label for="natureRsaGovernment">RSA Government</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="natureRetirementFund" name="nature" value="retirementFund">
                    <label for="natureRetirementFund">Retirement Fund</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="natureOther" name="nature" value="other">
                    <label for="natureOther">Other</label>
                  </div>
                </div>
                
                <div class="form-group mt-3">
                  <label for="otherNature" class="block text-gray-700 mb-1">If 'Other', please specify:</label>
                  <input type="text" id="otherNature" name="otherNature" class="w-full">
                </div>
              </div>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                <div class="form-group">
                  <label for="idNumberDtd" class="block text-gray-700 mb-1 required-field">Identity/Passport/Registration #:</label>
                  <input type="text" id="idNumberDtd" name="idNumberDtd" class="w-full" required>
                </div>
                <div class="form-group">
                  <label for="dateOfBirth" class="block text-gray-700 mb-1 required-field">Date of Birth/Inception:</label>
                  <input type="date" id="dateOfBirth" name="dateOfBirth" class="w-full" required>
                </div>
                <div class="form-group">
                  <label for="incomeTaxReference" class="block text-gray-700 mb-1 required-field">SA Income Tax Reference #:</label>
                  <input type="text" id="incomeTaxReference" name="incomeTaxReference" class="w-full" required>
                </div>
                <div class="form-group col-span-2">
                  <label for="physicalAddress" class="block text-gray-700 mb-1 required-field">Physical Address:</label>
                  <textarea id="physicalAddress" name="physicalAddress" rows="2" class="w-full" required></textarea>
                </div>
                <div class="form-group">
                  <label for="physicalPostalCode" class="block text-gray-700 mb-1 required-field">Postal Code (physical):</label>
                  <input type="text" id="physicalPostalCode" name="physicalPostalCode" class="w-full" required>
                </div>
                <div class="form-group col-span-2">
                  <label for="postalAddress" class="block text-gray-700 mb-1">Postal Address:</label>
                  <textarea id="postalAddress" name="postalAddress" rows="2" class="w-full"></textarea>
                </div>
                <div class="form-group">
                  <label for="postalPostalCode" class="block text-gray-700 mb-1">Postal Code (postal):</label>
                  <input type="text" id="postalPostalCode" name="postalPostalCode" class="w-full">
                </div>
                <div class="form-group">
                  <label for="countryTaxResidence" class="block text-gray-700 mb-1 required-field">Country of Tax Residency:</label>
                  <input type="text" id="countryTaxResidence" name="countryTaxResidence" class="w-full" required>
                </div>
              </div>
            </div>
            
            <div class="mb-6">
              <h4 class="text-md font-medium mb-3">PART C: Exemption</h4>
              <p class="mb-2">Please select the one reason for dividend tax exemption:</p>
              
              <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                <div class="radio-option">
                  <input type="radio" id="exemptionA" name="exemptionReason" value="a">
                  <label for="exemptionA">Par (a) – Company resident in SA</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionB" name="exemptionReason" value="b">
                  <label for="exemptionB">Par (b) – Government/municipality (RSA)</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionC" name="exemptionReason" value="c">
                  <label for="exemptionC">Par (c) – Public benefit organisation</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionD" name="exemptionReason" value="d">
                  <label for="exemptionD">Par (d) – Trust in s37A</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionE" name="exemptionReason" value="e">
                  <label for="exemptionE">Par (e) – Institution in s10(1)(cA)</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionF" name="exemptionReason" value="f">
                  <label for="exemptionF">Par (f) – Fund in s10(1)(d)(i)/(ii)</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionG" name="exemptionReason" value="g">
                  <label for="exemptionG">Par (g) – Person in s10(1)(t)</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionH" name="exemptionReason" value="h">
                  <label for="exemptionH">Par (h) – Micro business shareholder</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionI" name="exemptionReason" value="i">
                  <label for="exemptionI">Par (i) – Small business funding entity</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionJ" name="exemptionReason" value="j">
                  <label for="exemptionJ">Par (j) – Non-resident for foreign dividends</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionK" name="exemptionReason" value="k">
                  <label for="exemptionK">Par (k) – Portfolio of investment schemes</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionL" name="exemptionReason" value="l">
                  <label for="exemptionL">Par (l) – Dividend is normal taxable income</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionM" name="exemptionReason" value="m">
                  <label for="exemptionM">Par (m) – Dividend was subject to STC</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionN" name="exemptionReason" value="n">
                  <label for="exemptionN">Par (n) – Fidelity/indemnity funds</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionO" name="exemptionReason" value="o">
                  <label for="exemptionO">Par (w) – REIT dividends or property company</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="exemptionX" name="exemptionReason" value="x">
                  <label for="exemptionX">Par (x) – Other</label>
                </div>
              </div>
            </div>
          </div>
          
          <!-- W‑8BEN Form Container (for non-South Africans) -->
          <div id="w8ben-form-container" class="tax-form-container hidden">
            <h3 class="text-lg font-semibold mb-4">Form W-8BEN: Certificate of Foreign Status</h3>
            <p class="italic mb-4">Certificate of Foreign Status of Beneficial Owner for United States Tax Withholding and Reporting (Individuals)</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="form-group">
                <label for="primaryTaxCountry" class="block text-gray-700 font-medium mb-2 required-field">Country of Primary Tax Residence</label>
                <select name="primaryTaxCountry" id="primaryTaxCountry" class="w-full" required>
                  <option value="">Select a country</option>
                  <option value="US">United States</option>
                  <option value="CA">Canada</option>
                  <option value="UK">United Kingdom</option>
                  <option value="AU">Australia</option>
                  <!-- More countries would be added here -->
                </select>
              </div>
              
              <div class="form-group">
                <label for="taxNumber" class="block text-gray-700 font-medium mb-2 required-field">Tax Number in Primary Country</label>
                <input type="text" name="taxNumber" id="taxNumber" class="w-full" required placeholder="Enter your tax number">
              </div>
            </div>
            
            <div class="mt-4">
              <label class="block text-gray-700 font-medium mb-2 required-field">Are you a tax resident of any other country?</label>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" name="hasOtherTaxResidence" id="hasOtherTaxYes" value="yes" required>
                  <label for="hasOtherTaxYes">Yes</label>
                </div>
                <div class="radio-option">
                  <input type="radio" name="hasOtherTaxResidence" id="hasOtherTaxNo" value="no" required>
                  <label for="hasOtherTaxNo">No</label>
                </div>
              </div>
            </div>
            
            <div id="secondary-tax" class="mt-4 hidden">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="form-group">
                  <label for="secondaryTaxCountry" class="block text-gray-700 font-medium mb-2 required-field">Secondary Tax Country</label>
                  <select name="secondaryTaxCountry" id="secondaryTaxCountry" class="w-full" required>
                    <option value="">Select a country</option>
                    <option value="US">United States</option>
                    <option value="CA">Canada</option>
                    <option value="UK">United Kingdom</option>
                    <option value="AU">Australia</option>
                    <!-- More countries would be added here -->
                  </select>
                </div>
                
                <div class="form-group">
                  <label for="secondaryTaxNumber" class="block text-gray-700 font-medium mb-2 required-field">Tax Number in Secondary Country</label>
                  <input type="text" name="secondaryTaxNumber" id="secondaryTaxNumber" class="w-full" required placeholder="Enter your secondary tax number">
                </div>
              </div>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-4">
              <div class="form-group">
                <label class="block text-gray-700 font-medium mb-2 required-field">Are you a US citizen?</label>
                <div class="radio-group">
                  <div class="radio-option">
                    <input type="radio" name="isUSCitizen" id="usCitizenYes" value="yes" required>
                    <label for="usCitizenYes">Yes</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" name="isUSCitizen" id="usCitizenNo" value="no" required>
                    <label for="usCitizenNo">No</label>
                  </div>
                </div>
              </div>
              
              <div class="form-group">
                <label class="block text-gray-700 font-medium mb-2 required-field">Are you a US tax resident?</label>
                <div class="radio-group">
                  <div class="radio-option">
                    <input type="radio" name="isUSTaxResident" id="usTaxResidentYes" value="yes" required>
                    <label for="usTaxResidentYes">Yes</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" name="isUSTaxResident" id="usTaxResidentNo" value="no" required>
                    <label for="usTaxResidentNo">No</label>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="border border-gray-300 rounded-lg p-6 mt-6">
              <div class="bg-gray-100 p-4 mb-4 rounded">
                <div class="flex justify-between mb-2">
                  <div>
                    <p class="text-sm">Form <strong>W-8BEN</strong></p>
                    <p class="text-xs">
                      (Rev. October 2021)<br>
                      Department of the Treasury<br>
                      Internal Revenue Service
                    </p>
                  </div>
                  <div class="text-center">
                    <h3 class="font-semibold">Certificate of Foreign Status of Beneficial Owner for United States Tax Withholding and Reporting (Individuals)</h3>
                    <p class="text-xs">
                      ► For use by individuals. Entities must use Form W-8BEN-E.<br>
                      ► Go to www.irs.gov/FormW8BEN for instructions and the latest information.<br>
                      ► Give this form to the withholding agent or payer. Do not send to the IRS.
                    </p>
                  </div>
                  <div class="text-right">
                    <p class="text-xs">OMB No. 1545-1621</p>
                  </div>
                </div>
              </div>
              
              <p class="text-xs italic mb-4">
                Note: If you are resident in a FATCA partner jurisdiction (that is, a Model 1 IGA jurisdiction with reciprocity), certain tax account information may be provided to your jurisdiction of residence.
              </p>
              
              <div class="bg-gray-800 text-white text-sm font-semibold p-2 rounded">Part I Identification of Beneficial Owner</div>
              
              <div class="grid grid-cols-2 gap-4 mt-4">
                <div class="form-group">
                  <label class="text-xs">1. Name of individual who is the beneficial owner</label>
                  <p class="text-sm py-1 border-b border-gray-300" id="w8name"><!-- Auto-filled from form data --></p>
                </div>
                <div class="form-group">
                  <label class="text-xs">2. Country of citizenship</label>
                  <p class="text-sm py-1 border-b border-gray-300" id="w8citizenship"><!-- Auto-filled from form data --></p>
                </div>
              </div>
              
              <div class="form-group mt-3">
                <label class="text-xs">3. Permanent residence address (street, apt. or suite no., or rural route). <strong>Do not use a P.O. box or in-care-of address.</strong></label>
                <p class="text-sm py-1 border-b border-gray-300" id="w8address"><!-- Auto-filled from form data --></p>
              </div>
              
              <div class="grid grid-cols-2 gap-4 mt-3">
                <div class="form-group">
                  <label class="text-xs">City or town, state or province. Include postal code where appropriate.</label>
                  <p class="text-sm py-1 border-b border-gray-300" id="w8cityortown"><!-- Auto-filled from form data --></p>
                </div>
                <div class="form-group">
                  <label class="text-xs">Country</label>
                  <p class="text-sm py-1 border-b border-gray-300" id="w8residencecountry"><!-- Auto-filled from form data --></p>
                </div>
              </div>
              
              <!-- Additional W-8BEN fields would continue here -->
            </div>
          </div>
        </section>
        
        <!-- Step 6: Declarations -->
        <section id="section6" class="form-section">
          <h2 class="text-xl font-semibold mb-6">Declarations</h2>
          
          <div class="bg-blue-50 p-6 rounded-lg mb-6">
            <h3 class="text-lg font-medium text-blue-900 mb-2">Data Protection Notice</h3>
            <p class="text-blue-800">By signing, you confirm that you have read and agree to DMA's Privacy Notice and consent to the necessary checks.</p>
          </div>
          
          <div class="bg-gray-50 p-6 rounded-lg mb-6">
            <h3 class="text-lg font-medium mb-2">Terms and Documentation</h3>
            <p class="mb-4">I confirm that I have obtained and understood the following from <a href="https://www.dma.co.za" target="_blank" class="text-blue-600 hover:underline">www.dma.co.za</a>:</p>
            <ol class="list-decimal pl-6 mb-4">
              <li class="mb-1">The General Business Terms</li>
              <li class="mb-1">DMA Privacy Notice</li>
              <li class="mb-1">Commission, Charges &amp; Margin Schedule</li>
              <li class="mb-1">Order Execution Policy</li>
              <li class="mb-1">Conflict of Interest Policy</li>
              <li class="mb-1">Market Conduct Information</li>
            </ol>
            <div class="form-group">
              <div class="checkbox-option">
                <input type="checkbox" id="fExecPolicy" name="fExecPolicy" required>
                <label for="fExecPolicy">I consent to the Order Execution Policy.</label>
              </div>
            </div>
          </div>
          
          <div class="bg-gray-50 p-6 rounded-lg mb-6">
            <h3 class="text-lg font-medium mb-4">Declarations and Acknowledgements</h3>
            <div class="space-y-3">
              <div class="checkbox-option">
                <input type="checkbox" id="fReadRisk" name="fReadRisk" required>
                <label for="fReadRisk">I have read and understood the risks of trading.</label>
              </div>
              <div class="checkbox-option">
                <input type="checkbox" id="fOwnFunds" name="fOwnFunds" required>
                <label for="fOwnFunds">All funds deposited are my own.</label>
              </div>
              <div class="checkbox-option">
                <input type="checkbox" id="fNoHealthIssues" name="fNoHealthIssues" required>
                <label for="fNoHealthIssues">I am not aware of any condition affecting my account operation.</label>
              </div>
              <div class="checkbox-option">
                <input type="checkbox" id="fAccurateInfo" name="fAccurateInfo" required>
                <label for="fAccurateInfo">I have provided true, accurate, and complete information.</label>
              </div>
              <div class="checkbox-option">
                <input type="checkbox" id="fTaxObligation" name="fTaxObligation" required>
                <label for="fTaxObligation">I accept that DMA may share my info with tax authorities if required.</label>
              </div>
            </div>
          </div>
          
          <div class="bg-gray-50 p-6 rounded-lg">
            <h3 class="text-lg font-medium mb-4">Signature</h3>
            <div class="form-group">
              <label class="block text-gray-700 font-medium mb-2 required-field">Please sign below</label>
              <canvas id="signatureCanvas" width="600" height="200"></canvas>
              <div id="signatureError" class="text-red-600 mt-2 hidden">Please provide your signature.</div>
              <button type="button" id="clearSignature" class="mt-4 bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md">Clear Signature</button>
              <input type="hidden" id="signatureData" name="signatureData" required>
            </div>
          </div>
        </section>
      </form>
      
      <!-- Navigation Buttons -->
      <div class="flex justify-between mt-8">
        <button type="button" id="prevBtn" class="hidden">Back</button>
        <button type="button" id="nextBtn">Next</button>
      </div>
      
      <!-- Completion Screen -->
      <div id="completionScreen" class="text-center py-12 hidden">
        <svg class="w-16 h-16 text-green-500 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
        </svg>
        <h2 class="text-2xl font-semibold text-gray-900 mb-4">Submission Complete</h2>
        <p class="text-lg text-gray-600 max-w-md mx-auto">
          We will send you an email shortly. Thank you for taking the time to complete this form 🙂
        </p>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Elements
      const instructionsPage = document.getElementById('instructionsPage');
      const mainFormContainer = document.getElementById('mainFormContainer');
      const startButton = document.getElementById('startButton');
      const form = document.getElementById('dmaForm');
      const sections = document.querySelectorAll('.form-section');
      const progressSteps = document.querySelectorAll('.progress-step');
      const progressLine = document.getElementById('active-progress-line');
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');
      const completionScreen = document.getElementById('completionScreen');
      
      // Current step tracker
      let currentStep = 0;
      
      // Show/hide instructions and main form
      startButton.addEventListener('click', function() {
        instructionsPage.classList.add('hidden');
        mainFormContainer.classList.remove('hidden');
        updateProgressBar();
      });
      
      // Form navigation
      function showStep(stepIndex) {
        // Hide all sections
        sections.forEach(section => {
          section.classList.remove('active');
        });
        
        // Show current section
        sections[stepIndex].classList.add('active');
        
        // Update buttons
        prevBtn.classList.toggle('hidden', stepIndex === 0);
        nextBtn.textContent = stepIndex === sections.length - 1 ? 'Submit' : 'Next';
        
        // Update progress bar
        updateProgressBar();
        
        // Scroll to top
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
      
      function updateProgressBar() {
        // Update progress steps
        progressSteps.forEach((step, index) => {
          if (index < currentStep) {
            step.classList.add('completed');
            step.classList.remove('active');
          } else if (index === currentStep) {
            step.classList.add('active');
            step.classList.remove('completed');
          } else {
            step.classList.remove('active', 'completed');
          }
        });
        
        // Update progress line
        const progressPercentage = ((currentStep) / (progressSteps.length - 1)) * 100;
        progressLine.style.width = `${progressPercentage}%`;
        
        // Update labels text colors
        document.querySelectorAll('[id^="label"]').forEach((label, index) => {
          if (index < currentStep) {
            label.classList.remove('text-gray-500', 'text-orange-600');
            label.classList.add('text-green-600');
          } else if (index === currentStep) {
            label.classList.remove('text-gray-500', 'text-green-600');
            label.classList.add('text-orange-600');
          } else {
            label.classList.remove('text-orange-600', 'text-green-600');
            label.classList.add('text-gray-500');
          }
        });
      }
      
      // Navigation event listeners
      prevBtn.addEventListener('click', function() {
        if (currentStep > 0) {
          currentStep--;
          showStep(currentStep);
        }
      });
      
      nextBtn.addEventListener('click', function() {
        if (validateSection(currentStep)) {
          if (currentStep < sections.length - 1) {
            currentStep++;
            showStep(currentStep);
          } else {
            // Form submitted
            form.style.display = 'none';
            document.querySelector('.navigation-buttons').style.display = 'none';
            completionScreen.classList.remove('hidden');
            // In a real application, you would submit the form data here
          }
        }
      });
      
      // Validation function
      function validateSection(stepIndex) {
        const currentSection = sections[stepIndex];
        const requiredFields = currentSection.querySelectorAll('[required]:not([type="hidden"])');
        let isValid = true;
        
        requiredFields.forEach(field => {
          if (!field.checkValidity()) {
            field.classList.add('border-red-500');
            isValid = false;
            
            // Add error message if it doesn't exist
            let errorMessage = field.nextElementSibling;
            if (!errorMessage || !errorMessage.classList.contains('text-red-600')) {
              errorMessage = document.createElement('p');
              errorMessage.classList.add('text-red-600', 'text-sm', 'mt-1');
              errorMessage.textContent = field.validationMessage || 'This field is required';
              field.parentNode.insertBefore(errorMessage, field.nextSibling);
            }
          } else {
            field.classList.remove('border-red-500');
            
            // Remove error message if it exists
            let errorMessage = field.nextElementSibling;
            if (errorMessage && errorMessage.classList.contains('text-red-600')) {
              errorMessage.remove();
            }
          }
        });
        
        // Special validation for signature canvas on last step
        if (stepIndex === sections.length - 1) {
          const signatureData = document.getElementById('signatureData');
          const signatureError = document.getElementById('signatureError');
          
          if (!signatureData.value) {
            signatureError.classList.remove('hidden');
            isValid = false;
          } else {
            signatureError.classList.add('hidden');
          }
        }
        
        return isValid;
      }
      
      // Event listeners for form fields to clear validation errors
      document.querySelectorAll('input, select, textarea').forEach(field => {
        field.addEventListener('input', function() {
          this.classList.remove('border-red-500');
          
          // Remove error message if it exists
          let errorMessage = this.nextElementSibling;
          if (errorMessage && errorMessage.classList.contains('text-red-600')) {
            errorMessage.remove();
          }
        });
      });
      
      // Setup Account Type options based on residency
      const residencyRadios = document.querySelectorAll('input[name="residency"]');
      const accountTypeSelect = document.getElementById('accountType');
      const baseCurrencySelect = document.getElementById('baseCurrencySelect');
      
      residencyRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          // Clear previous options
          accountTypeSelect.innerHTML = '<option value="" disabled selected>Select an option</option>';
          
          if (this.value === 'sa') {
            // South African resident options
            const options = [
              { value: 'onshore', text: 'Onshore Account (ZAR denominated)' },
              { value: 'offshore', text: 'Offshore Account (International)' },
              { value: 'both', text: 'Both Onshore and Offshore accounts' }
            ];
            
            options.forEach(option => {
              const optionElement = document.createElement('option');
              optionElement.value = option.value;
              optionElement.textContent = option.text;
              accountTypeSelect.appendChild(optionElement);
            });
            
            // Update dividends tax form visibility
            document.getElementById('dtd-form-container').classList.remove('hidden');
            document.getElementById('w8ben-form-container').classList.add('hidden');
          } else {
            // Foreign resident options
            const optionElement = document.createElement('option');
            optionElement.value = 'offshore';
            optionElement.textContent = 'Offshore Account (International)';
            accountTypeSelect.appendChild(optionElement);
            
            // Update dividends tax form visibility
            document.getElementById('dtd-form-container').classList.add('hidden');
            document.getElementById('w8ben-form-container').classList.remove('hidden');
          }
        });
      });
      
      // Account type change event
      accountTypeSelect.addEventListener('change', function() {
        // Clear previous options
        baseCurrencySelect.innerHTML = '<option value="" disabled selected>Select an option</option>';
        
        if (this.value === 'onshore') {
          // Onshore account - ZAR only
          const optionElement = document.createElement('option');
          optionElement.value = 'ZAR';
          optionElement.textContent = 'ZAR';
          baseCurrencySelect.appendChild(optionElement);
          baseCurrencySelect.value = 'ZAR';
          baseCurrencySelect.disabled = true;
        } else if (this.value === 'offshore' || this.value === 'both') {
          // Offshore account - multiple currencies
          const currencies = ['USD', 'GBP', 'EUR'];
          currencies.forEach(currency => {
            const optionElement = document.createElement('option');
            optionElement.value = currency;
            optionElement.textContent = currency;
            baseCurrencySelect.appendChild(optionElement);
          });
          baseCurrencySelect.disabled = false;
        }
      });
      
      // US Citizen warning
      const usCitizenRadios = document.querySelectorAll('input[name="usCitizen"]');
      const usCitizenWarning = document.getElementById('usCitizenWarning');
      
      usCitizenRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'yes') {
            usCitizenWarning.classList.remove('hidden');
            accountTypeSelect.disabled = true;
            baseCurrencySelect.disabled = true;
          } else {
            usCitizenWarning.classList.add('hidden');
            accountTypeSelect.disabled = false;
            baseCurrencySelect.disabled = false;
          }
        });
      });
      
      // Other title toggle
      const titleSelect = document.getElementById('title');
      const otherTitleDiv = document.getElementById('otherTitleDiv');
      
      titleSelect.addEventListener('change', function() {
        if (this.value === 'Other') {
          otherTitleDiv.classList.remove('hidden');
          document.getElementById('otherTitle').setAttribute('required', '');
        } else {
          otherTitleDiv.classList.add('hidden');
          document.getElementById('otherTitle').removeAttribute('required');
        }
      });
      
      // ID Number auto-populate DOB for South African ID
      const idNumberInput = document.getElementById('idNumber');
      const dobInput = document.getElementById('dob');
      
      idNumberInput.addEventListener('blur', function() {
        const idNumber = this.value;
        // Check if it's a South African ID number format (13 digits)
        if (idNumber.length === 13 && /^\d+$/.test(idNumber)) {
          // Extract date components from first 6 digits (YYMMDD)
          const year = parseInt(idNumber.substring(0, 2));
          const month = parseInt(idNumber.substring(2, 4));
          const day = parseInt(idNumber.substring(4, 6));
          
          // Determine full year (assuming 19xx for years > 22, otherwise 20xx)
          const fullYear = year > 22 ? 1900 + year : 2000 + year;
          
          // Format date as ISO string (YYYY-MM-DD)
          const formattedDate = `${fullYear}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
          dobInput.value = formattedDate;
        }
      });
      
      // Address duration toggle
      const addressDurationRadios = document.querySelectorAll('input[name="addressDuration"]');
      const previousAddressDiv = document.getElementById('previousAddressDiv');
      
      addressDurationRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'no') {
            previousAddressDiv.classList.remove('hidden');
            // Add required attribute to previous address fields
            previousAddressDiv.querySelectorAll('input').forEach(input => {
              input.setAttribute('required', '');
            });
          } else {
            previousAddressDiv.classList.add('hidden');
            // Remove required attribute from previous address fields
            previousAddressDiv.querySelectorAll('input').forEach(input => {
              input.removeAttribute('required');
            });
          }
        });
      });
      
      // Multiple nationalities toggle
      const multipleNationalitiesRadios = document.querySelectorAll('input[name="multipleNationalities"]');
      const multipleNationalitiesContainer = document.getElementById('multipleNationalitiesContainer');
      
      multipleNationalitiesRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'yes') {
            multipleNationalitiesContainer.classList.remove('hidden');
          } else {
            multipleNationalitiesContainer.classList.add('hidden');
          }
        });
      });
      
      // Function to add more nationality fields
      document.querySelector('#nationality-dropdowns .plus-button').addEventListener('click', function() {
        const container = document.getElementById('nationality-dropdowns');
        const items = container.querySelectorAll('.nationality-item');
        
        if (items.length < 5) {
          const newItem = items[0].cloneNode(true);
          newItem.querySelector('select').value = '';
          
          // Replace plus button with minus button for all but the first item
          const plusButton = newItem.querySelector('.plus-button');
          const minusButton = document.createElement('button');
          minusButton.type = 'button';
          minusButton.className = 'minus-button';
          minusButton.textContent = '-';
          plusButton.parentNode.replaceChild(minusButton, plusButton);
          
          // Add event listener to minus button
          minusButton.addEventListener('click', function() {
            this.closest('.nationality-item').remove();
          });
          
          container.appendChild(newItem);
        } else {
          alert('Maximum of 5 nationalities allowed');
        }
      });
      
      // Function to add more country fields
      document.querySelector('#country-dropdowns .plus-button').addEventListener('click', function() {
        const container = document.getElementById('country-dropdowns');
        const items = container.querySelectorAll('.country-item');
        
        if (items.length < 5) {
          const newItem = items[0].cloneNode(true);
          newItem.querySelector('select').value = '';
          
          // Replace plus button with minus button for all but the first item
          const plusButton = newItem.querySelector('.plus-button');
          const minusButton = document.createElement('button');
          minusButton.type = 'button';
          minusButton.className = 'minus-button';
          minusButton.textContent = '-';
          plusButton.parentNode.replaceChild(minusButton, plusButton);
          
          // Add event listener to minus button
          minusButton.addEventListener('click', function() {
            this.closest('.country-item').remove();
          });
          
          container.appendChild(newItem);
        } else {
          alert('Maximum of 5 countries allowed');
        }
      });
      
      // Employment checkbox toggles
      const employmentCheckbox = document.getElementById('employmentCheckbox');
      const employmentDetails = document.getElementById('employmentDetails');
      
      employmentCheckbox.addEventListener('change', function() {
        if (this.checked) {
          employmentDetails.classList.remove('hidden');
          employmentDetails.querySelectorAll('[required]').forEach(input => {
            input.setAttribute('required', '');
          });
        } else {
          employmentDetails.classList.add('hidden');
          employmentDetails.querySelectorAll('[required]').forEach(input => {
            input.removeAttribute('required');
          });
        }
      });
      
      const selfEmployedCheckbox = document.getElementById('selfEmployedCheckbox');
      const selfEmployedDetails = document.getElementById('selfEmployedDetails');
      
      selfEmployedCheckbox.addEventListener('change', function() {
        if (this.checked) {
          selfEmployedDetails.classList.remove('hidden');
          selfEmployedDetails.querySelectorAll('[required]').forEach(input => {
            input.setAttribute('required', '');
          });
        } else {
          selfEmployedDetails.classList.add('hidden');
          selfEmployedDetails.querySelectorAll('[required]').forEach(input => {
            input.removeAttribute('required');
          });
        }
      });
      
      const otherFundCheckbox = document.getElementById('otherFundCheckbox');
      const otherFundDetails = document.getElementById('otherFundDetails');
      
      otherFundCheckbox.addEventListener('change', function() {
        if (this.checked) {
          otherFundDetails.classList.remove('hidden');
          otherFundDetails.querySelectorAll('[required]').forEach(input => {
            input.setAttribute('required', '');
          });
        } else {
          otherFundDetails.classList.add('hidden');
          otherFundDetails.querySelectorAll('[required]').forEach(input => {
            input.removeAttribute('required');
          });
        }
      });
      
      // Secondary tax residence toggle
      const hasOtherTaxResidenceRadios = document.querySelectorAll('input[name="hasOtherTaxResidence"]');
      const secondaryTaxDiv = document.getElementById('secondary-tax');
      
      hasOtherTaxResidenceRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'yes') {
            secondaryTaxDiv.classList.remove('hidden');
            secondaryTaxDiv.querySelectorAll('[required]').forEach(input => {
              input.setAttribute('required', '');
            });
          } else {
            secondaryTaxDiv.classList.add('hidden');
            secondaryTaxDiv.querySelectorAll('[required]').forEach(input => {
              input.removeAttribute('required');
            });
          }
        });
      });
      
      // Signature canvas
      const canvas = document.getElementById('signatureCanvas');
      const signatureDataInput = document.getElementById('signatureData');
      const clearSignatureBtn = document.getElementById('clearSignature');
      const ctx = canvas.getContext('2d');
      
      let isDrawing = false;
      let lastX = 0;
      let lastY = 0;
      
      function startDrawing(e) {
        isDrawing = true;
        [lastX, lastY] = getCoordinates(e);
      }
      
      function draw(e) {
        if (!isDrawing) return;
        
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
        ctx.strokeStyle = '#000';
        
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        const [x, y] = getCoordinates(e);
        ctx.lineTo(x, y);
        ctx.stroke();
        
        [lastX, lastY] = [x, y];
        
        // Save signature data
        signatureDataInput.value = canvas.toDataURL();
      }
      
      function stopDrawing() {
        isDrawing = false;
      }
      
      function getCoordinates(e) {
        const rect = canvas.getBoundingClientRect();
        const scaleX = canvas.width / rect.width;
        const scaleY = canvas.height / rect.height;
        
        if (e.type.includes('touch')) {
          return [
            (e.touches[0].clientX - rect.left) * scaleX,
            (e.touches[0].clientY - rect.top) * scaleY
          ];
        } else {
          return [
            (e.clientX - rect.left) * scaleX,
            (e.clientY - rect.top) * scaleY
          ];
        }
      }
      
      // Mouse events
      canvas.addEventListener('mousedown', startDrawing);
      canvas.addEventListener('mousemove', draw);
      canvas.addEventListener('mouseup', stopDrawing);
      canvas.addEventListener('mouseout', stopDrawing);
      
      // Touch events
      canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        startDrawing(e);
      });
      canvas.addEventListener('touchmove', (e) => {
        e.preventDefault();
        draw(e);
      });
      canvas.addEventListener('touchend', (e) => {
        e.preventDefault();
        stopDrawing();
      });
      
      // Clear signature
      clearSignatureBtn.addEventListener('click', function() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        signatureDataInput.value = '';
      });
      
      // W-8BEN Form auto-population
      function updateW8BENForm() {
        // This would populate fields in the W-8BEN form based on user input
        const nameElement = document.getElementById('w8name');
        const citizenshipElement = document.getElementById('w8citizenship');
        const addressElement = document.getElementById('w8address');
        const cityTownElement = document.getElementById('w8cityortown');
        const countryElement = document.getElementById('w8residencecountry');
        
        if (nameElement && citizenshipElement && addressElement && cityTownElement && countryElement) {
          const firstName = document.getElementById('forenames')?.value || '';
          const surname = document.getElementById('surname')?.value || '';
          const fullName = `${firstName} ${surname}`;
          nameElement.textContent = fullName;
          
          const nationality = document.getElementById('nationality')?.value || '';
          citizenshipElement.textContent = nationality;
          
          const addressLine1 = document.getElementById('currentFlatNo')?.value || '';
          const addressLine2 = document.getElementById('currentStreetNo')?.value || '';
          addressElement.textContent = `${addressLine1} ${addressLine2}`;
          
          const city = document.getElementById('currentTownCity')?.value || '';
          const postalCode = document.getElementById('currentPostalCode')?.value || '';
          cityTownElement.textContent = `${city} ${postalCode}`;
          
          const country = document.getElementById('currentCountry')?.value || '';
          countryElement.textContent = country;
        }
      }
      
      // Add event listener to auto-update W-8BEN form when going to Step 5
      nextBtn.addEventListener('click', function() {
        if (currentStep === 4) { // Going to Step 5 (Dividends Tax)
          updateW8BENForm();
        }
      });
      
      // Initialize with first step active
      showStep(currentStep);
    });
  </script>
</body>

</html>