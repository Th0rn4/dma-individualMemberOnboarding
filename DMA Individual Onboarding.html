<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>DMA Individual Onboarding – Merged Form</title>
    <style>
        /* -------------------------------
           GLOBAL RESETS & BASE STYLES
        --------------------------------*/
        /* ---------------------------------------
           1. Base & Global Reset
        ---------------------------------------- */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* Dark blue background */
        body {
            position: relative;
            background-color: #0E233B;
            color: #012C37;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }

            /* Thin orange diagonal line from top-left to bottom-right */
            body::before {
                content: "";
                position: absolute;
                top: 0;
                left: 0;
                width: 200vw;
                height: 200px;
                background-color: #FF4500;
                transform: rotate(30deg);
                transform-origin: top left;
                z-index: -1;
            }

        /* ---------------------------------------
           2. Form Container & Header
        ---------------------------------------- */
        .container {
            max-width: 900px;
            margin: 6rem auto 3rem;
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 40px 30px;
            position: relative;
            overflow: hidden;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: none;
            position: relative;
            z-index: 1;
        }

            .header img.logo {
                float: none;
                display: block;
                margin: 0 auto 15px auto;
                max-width: 140px;
            }

            .header h1 {
                color: #012C37;
                text-transform: uppercase;
                letter-spacing: 1px;
                font-size: 1.8rem;
                margin: 0 auto 10px;
            }

            .header p {
                color: #555;
                margin-top: 5px;
            }

        /* ---------------------------------------
           3. Progress Bar
        ---------------------------------------- */
        .progress-container {
            margin: 30px auto 0 auto;
            max-width: 700px;
            position: relative;
        }

        .progress-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin: 20px 0;
        }

        .progress-line {
            position: absolute;
            top: 50%;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: #e0e0e0;
            z-index: 0;
            transform: translateY(-50%);
        }

        .progress-line-active {
            position: absolute;
            top: 50%;
            left: 0;
            width: 0%;
            height: 2px;
            background-color: #FF4500;
            z-index: 1;
            transform: translateY(-50%);
            transition: width 0.3s ease;
        }

        .progress-step {
            position: relative;
            z-index: 2;
            text-align: center;
        }

        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #ddd;
            color: #666;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .progress-step.completed .step-number {
            background-color: #FF4500 !important;
            color: #ffffff !important;
        }

        .step-title {
            font-size: 0.85rem;
            color: #012C37;
            font-weight: 600;
        }

        /* ---------------------------------------
           4. Section Styling
        ---------------------------------------- */
        .section {
            margin-bottom: 30px;
            padding: 20px 0 0;
            border-radius: 8px;
            display: none;
            position: relative;
            z-index: 1;
        }

            .section.active {
                display: block;
            }

        .section-header h2 {
            color: #012C37;
            font-size: 1.4rem;
            margin-bottom: 15px;
        }
        
        .subsection {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .subsection h3 {
            color: #012C37;
            font-size: 1.2rem;
            margin-bottom: 10px;
        }

        /* ---------------------------------------
           5. Form Layout, Inputs & Labels
        ---------------------------------------- */
        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
            }
        }

        .form-group {
            margin-bottom: 20px;
        }

            .form-group.full-width {
                grid-column: 1 / -1;
            }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        input,
        select,
        textarea {
            width: 80%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.3s;
            background-color: #fff;
            color: #333;
        }

            input:focus,
            select:focus,
            textarea:focus {
                outline: none;
                border-color: #012C37;
            }

        textarea {
            height: 120px;
            resize: vertical;
        }

        /* Radio & Checkbox groups */
        .radio-group,
        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .radio-option,
        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }

            .radio-option input[type="radio"],
            .checkbox-option input[type="checkbox"] {
                display: none;
            }

            .radio-option label,
            .checkbox-option label {
                padding: 10px 20px;
                font-size: 14px;
                cursor: pointer;
                background-color: transparent;
                border: 2px solid #ccc;
                border-radius: 5px;
                transition: background-color 0.3s ease, color 0.3s ease, border 0.3s ease;
                white-space: nowrap;
            }

            .radio-option input[type="radio"]:checked + label,
            .checkbox-option input[type="checkbox"]:checked + label {
                background-color: #FF4500;
                color: #fff;
                border-color: #FF4500;
            }

        /* ---------------------------------------
           6. Buttons & Navigation
        ---------------------------------------- */
        button,
        .btn-primary {
            background-color: #FF4500;
            color: #ffffff;
            padding: 14px 30px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
            min-width: 150px;
            font-weight: 600;
        }

            button:hover,
            .btn-primary:hover {
                background-color: #e34300;
            }

        .navigation-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }

        button.secondNationality,
        button.secondCountry {
            display: inline-block !important;
            width: auto !important;
            background-color: #0E233B;
            color: #ffffff;
            border: none;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 1rem;
            font-weight: 600;
            min-width: 50px;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.3s ease;
        }

        /* ---------------------------------------
           7. Error States
        ---------------------------------------- */
        .error-message {
            color: #B00020;
            font-size: 13px;
            display: none;
            margin-top: 4px;
        }

        .invalid {
            border: 1px solid #B00020;
            background-color: #ffe6e6;
        }

        /* ---------------------------------------
           8. Completion Screen
        ---------------------------------------- */
        #completionScreen {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }

            #completionScreen h2 {
                font-size: 2rem;
                color: #012C37;
                margin-bottom: 20px;
            }

        .completionText {
            color: #2C3E50;
            font-size: 1.2rem;
            line-height: 1.5;
            margin: 0 auto;
            max-width: 600px;
        }

        /* ---------------------------------------
           9. Signature Canvas
        ---------------------------------------- */
        #signatureCanvas {
            border: 3px solid #ccc;
            border-radius: 6px;
            width: 100%;
            max-width: 400px;
            height: 200px;
        }

        /* Toggle switches in Step 4 (if used) */
        .switch {
            position: relative;
            display: inline-block;
            width: 46px;
            height: 24px;
        }

            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

            .slider:before {
                position: absolute;
                content: "";
                height: 18px;
                width: 18px;
                left: 3px;
                bottom: 3px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
            }

        input:checked + .slider {
            background-color: #FF4500;
        }

            input:checked + .slider:before {
                transform: translateX(22px);
            }
    </style>
</head>
<body>
    <!-- ===== Instructions Page (Not in progress bar) ===== -->
    <div class="container" id="instructionsPage">
        <div class="header">
            <h1>Instructions</h1>
            <div class="section-content">
                <div class="full-width">
                    <p style="font-size:0.9rem;">
                        <strong>Thank you for choosing DMA!</strong> This online form usually takes about <strong>10 minutes</strong> to complete.<br />
                        If you’re a <strong>non-South African resident</strong>, please note <em>all documents must be certified</em> (e.g. passport, proof of address, proof of banking).<br /><br />
                        We highly recommend having your documents ready to upload:
                    </p>
                    <ul style="font-size:0.9rem; margin-top:0; text-align:left">
                        <li><b>Valid ID/Passport</b> (This can be an ID Card (both sides) or a Passport)</li>
                        <li><b>Proof of address (not older than 3 months)</b> (This can be a Municipal Account in your name, a Lease Agreement or a Utility Bill)</li>
                        <li><b>Proof of banking (not older than 3 months)</b> (This can be a letter from the bank or a bank statement. This must have your name, bank account number and bank name on the same statement)</li>
                        <li><b>Please ensure you have your Tax Number ready</b></li>
                    </ul>
                    <p style="font-size:0.9rem;">
                        For more info, visit our website:
                        <a href="https://www.dma.co" target="_blank" rel="noopener">https://www.dma.co</a>
                        or email us at
                        <a href="mailto:applications@dma.co.za">applications@dma.co.za</a>.
                    </p>
                </div>
            </div>
        </div>
        <button type="button" id="startButton" class="btn-primary">Start</button>
    </div>

    <!-- ===== Main Form Container ===== -->
    <div class="container" id="mainFormContainer" style="display:none;">
        <div class="header">
            <img src="https://dialog.tech/XvHmly0f" class="logo" alt="DMA Logo">
            <h1>DMA Individual Onboarding</h1>
            <p id="completeSteps">Please complete all required fields to proceed</p>
            <!-- Progress Bar (7 Steps) -->
            <div id="progressContainer" class="progress-container">
                <div class="progress-bar">
                    <div class="progress-line"></div>
                    <div class="progress-line-active"></div>
                    <div class="progress-step">
                        <div class="step-number">1</div>
                        <div class="step-title">Account Setup</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">2</div>
                        <div class="step-title">Personal Details</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">3</div>
                        <div class="step-title">Employment &amp; Bank Details</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">4</div>
                        <div class="step-title">Trading Experience</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">5</div>
                        <div class="step-title">Dividends Tax</div>
                    </div>
                    <div class="progress-step">
                        <div class="step-number">6</div>
                        <div class="step-title">Declarations</div>
                    </div>
                </div>
            </div>
        </div>

        <form id="mergedForm">
            <!-- ========= Step 1: Account Setup ========= -->
            <div class="section active" id="step1">
                <div class="section-header">
                    <h2>Account Setup</h2>
                </div>
                <div class="form-grid">
                    <div class="form-group full-width">
                        <label>Are you a South African Resident? <span style="color:red">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="residency" value="sa" id="residencyYes" onchange="toggleResidency()" required>
                                <label for="residencyYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="residency" value="foreign" id="residencyNo" onchange="toggleResidency()" required>
                                <label for="residencyNo">No</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group full-width" id="usCitizenSection">
                        <label>Are you a tax liable US citizen?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="usCitizen" value="yes" id="usCitizenYes" onclick="toggleUSCitizen()">
                                <label for="usCitizenYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="usCitizen" value="no" id="usCitizenNo" onclick="toggleUSCitizen()">
                                <label for="usCitizenNo">No</label>
                            </div>
                        </div>
                        <div id="usCitizenWarning" style="display:none; color:#B00020;"></div>
                    </div>
                    <div class="form-group">
                        <label for="accountType">Account Type <span style="color:red">*</span></label>
                        <select name="accountType" id="accountType" onchange="toggleAccountType()" required>
                            <option value="" disabled selected>Select an option</option>
                            <!-- For SA residents these options are populated dynamically -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="baseCurrencySelect" id="baseCurrencyLabel">Main Account Currency</label>
                        <select name="baseCurrency" id="baseCurrencySelect">
                            <option value="" disabled selected>Select an option</option>
                            <!-- Options will be dynamically updated based on Account Type -->
                        </select>
                    </div>
                </div>
            </div>

            <!-- ========= Step 2: Personal Details ========= -->
            <div class="section" id="step2">
                <div class="section-header">
                    <h2>Personal Details</h2>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="title">Title <span style="color:red">*</span></label>
                        <select name="title" id="title" required onchange="toggleOtherTitle()">
                            <option value="">Select</option>
                            <option value="Mr">Mr</option>
                            <option value="Mrs">Mrs</option>
                            <option value="Miss">Miss</option>
                            <option value="Ms">Ms</option>
                            <option value="Dr">Dr</option>
                            <option value="Other">Other</option>
                        </select>
                        <div id="otherTitleDiv" style="display:none; margin-top:0.5rem;">
                            <label for="otherTitle" style="font-weight:normal;">Please specify:</label>
                            <input type="text" name="otherTitle" id="otherTitle" placeholder="Specify your title">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="forenames">First Name <span style="color:red">*</span></label>
                        <input type="text" name="forenames" id="forenames" required placeholder="Enter your first name">
                    </div>
                    <div class="form-group">
                        <label for="surname">Surname <span style="color:red">*</span></label>
                        <input type="text" name="surname" id="surname" required placeholder="Enter your surname">
                    </div>
                    <div class="form-group">
                        <label for="dob">Date of Birth <span style="color:red">*</span></label>
                        <input type="date" name="dob" id="dob" required placeholder="YYYY-MM-DD">
                    </div>
                    <div class="form-group">
                        <label for="countryOfBirth">Country of Birth <span style="color:red">*</span></label>
                        <select name="countryOfBirth" id="countryOfBirth" required>
                            <option value="">Select Country</option>
                            <option value="South Africa">South Africa</option>
                            <option value="United Kingdom">United Kingdom</option>
                            <option value="USA">USA</option>
                            <option value="Netherlands">Netherlands</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cityOfBirth">Town/City of Birth <span style="color:red">*</span></label>
                        <input type="text" name="cityOfBirth" id="cityOfBirth" required placeholder="Enter your town/city of birth">
                    </div>
                    <!-- Moved Phone & Email Fields -->
                    <div class="form-group">
                        <label for="mobileNumber">Mobile Number <span style="color:red">*</span></label>
                        <div style="display: flex; gap: 10px;">
                            <select name="countryCode" style="max-width: 120px;">
                                <option value="+27">+27</option>
                                <option value="+1">+1</option>
                                <option value="+44">+44</option>
                                <option value="+61">+61</option>
                                <option value="+91">+91</option>
                            </select>
                            <input type="text" name="mobileNumber" id="mobileNumber" required placeholder="Enter your mobile number" pattern="[0-9]+">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email">Email Address <span style="color:red">*</span></label>
                        <input type="email" name="email" id="email" required placeholder="Enter your email address">
                    </div>
                    <!-- New ID Type field -->
                    <div class="form-group">
                        <label for="idType">ID Type <span style="color:red">*</span></label>
                        <select name="idType" id="idType" required>
                            <option value="">Select ID Type</option>
                            <option value="Drivers">Drivers</option>
                            <option value="ID Document">ID Document</option>
                            <option value="Passport">Passport</option>
                        </select>
                    </div>
                    <!-- Updated ID Document Number field -->
                    <div class="form-group">
                        <label for="idNumber">ID Document Number <span style="color:red">*</span></label>
                        <input type="text" name="idNumber" id="idNumber" required placeholder="Enter your ID document number">
                    </div>
                    <!-- Updated upload for ID document with context -->
                    <div class="form-group">
                        <label for="idUpload">Upload your ID Document (e.g. valid passport or both sides of an ID card, certified if foreign) <span style="color:red">*</span></label>
                        <input type="file" name="idUpload" id="idUpload" accept=".pdf, image/*" required>
                    </div>
                    <!-- New Tax Number field -->
                    <div class="form-group">
                        <label for="taxNumberPersonal">Tax Number <span style="color:red">*</span></label>
                        <input type="text" name="taxNumberPersonal" id="taxNumberPersonal" required placeholder="Enter your tax number">
                    </div>
                    <div class="form-group">
                        <label for="nationality">Nationality <span style="color:red">*</span></label>
                        <select name="nationality" id="nationality" required>
                            <option value="">Select Nationality</option>
                            <option value="South Africa">South Africa</option>
                            <option value="United Kingdom">United Kingdom</option>
                            <option value="USA">USA</option>
                            <option value="Netherlands">Netherlands</option>
                        </select>
                    </div>
                    <!-- Multiple Nationalities Question -->
                    <div class="form-group full-width">
                        <label>Do you have multiple nationalities? <span style="color:red">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="multipleNationalities" value="yes" id="multipleNationalitiesYes" onchange="toggleMultipleNationalities()" required>
                                <label for="multipleNationalitiesYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="multipleNationalities" value="no" id="multipleNationalitiesNo" onchange="toggleMultipleNationalities()" required>
                                <label for="multipleNationalitiesNo">No</label>
                            </div>
                        </div>
                    </div>
                    <!-- Container for additional nationality dropdowns -->
                    <div id="multipleNationalitiesContainer" style="display:none; margin-bottom: 15px;">
                        <label>If yes, please select other nationalities<span style="color:red">*</span></label>
                        <div class="nationality-dropdown-item" style="display: flex; align-items: center; margin-bottom: 5px;">
                            <select name="nationalities[]" class="nationality-select" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px;">
                                <option value="">Select a nationality</option>
                                <option value="South Africa">South Africa</option>
                                <option value="USA">USA</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="Canada">Canada</option>
                                <option value="Australia">Australia</option>
                            </select>
                        </div>
                        <button type="button" id="addNationalityBtn" required class="secondNationality">+</button>
                    </div>
                    <!-- Tax residency section -->
                    <div id="countryDropdownContainer" style="margin-bottom: 15px;">
                        <label>Do you have a tax residency in another country?</label>
                        <div class="country-dropdown-item" style="display: flex; align-items: center; margin-bottom: 5px;">
                            <select name="countries[]" class="country-select" style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 15px;">
                                <option value="">Select a country</option>
                                <option value="USA">USA</option>
                                <option value="Canada">Canada</option>
                                <option value="United Kingdom">United Kingdom</option>
                                <option value="South Africa">South Africa</option>
                                <option value="Australia">Australia</option>
                            </select>
                        </div>
                        <button type="button" id="addCountryBtn" class="secondCountry">+</button>
                    </div>
                    <!-- New Additional Tax Number field -->
                    <div class="form-group">
                        <label for="additionalTaxNumber">Additional Tax Number (if applicable)</label>
                        <input type="text" name="additionalTaxNumber" id="additionalTaxNumber" placeholder="Enter additional tax number if applicable">
                    </div>
                    
                    
                    <!-- Current Residential Address Fields -->
                    <div class="form-group full-width">
                        <h2>Current Residential Address</h2>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="currentFlatNo">Flat No/Building Name:</label>
                                <input type="text" name="currentFlatNo" id="currentFlatNo" placeholder="Enter flat number or building name">
                            </div>
                            <div class="form-group">
                                <label for="currentStreetNo">House/Street No.:</label>
                                <input type="text" name="currentStreetNo" id="currentStreetNo" placeholder="Enter house or street number">
                            </div>
                            <div class="form-group">
                                <label for="currentTownCity">Town/City:</label>
                                <input type="text" name="currentTownCity" id="currentTownCity" placeholder="Enter town or city">
                            </div>
                            <div class="form-group">
                                <label for="currentProvince">Province:</label>
                                <input type="text" name="currentProvince" id="currentProvince" placeholder="Enter province">
                            </div>
                            <div class="form-group">
                                <label for="currentPostalCode">Postal Code:</label>
                                <input type="text" name="currentPostalCode" id="currentPostalCode" placeholder="Enter postal code">
                            </div>
                            <div class="form-group">
                                <label for="currentCountry">Country:</label>
                                <input type="text" name="currentCountry" id="currentCountry" placeholder="Enter country">
                            </div>
                        </div>
                    </div>
                    <!-- Document upload for residential address supporting documents -->
                    <div class="form-group full-width">
                        <label for="resAddressDocs">Upload Supporting Document for Residential Address (e.g. bank statement, municipal account, or lease agreement, certified if foreign)</label>
                        <input type="file" name="resAddressDocs" id="resAddressDocs" accept=".pdf, image/*" placeholder="Upload bank statement, municipal account, or lease agreement">
                    </div>
                    <!-- Address Duration Question -->
                    <div class="form-group full-width">
                        <label>Have you been at your current address for 3 or more years? <span style="color:red">*</span></label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="addressDuration" value="yes" id="addressDurationYes" onchange="toggleAddressDuration()" required>
                                <label for="addressDurationYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="addressDuration" value="no" id="addressDurationNo" onchange="toggleAddressDuration()" required>
                                <label for="addressDurationNo">No</label>
                            </div>
                        </div>
                    </div>
                    <!-- Previous Residential Address Fields (Initially Hidden) -->
                    <div class="form-group full-width" id="previousAddressDiv" style="display:none;">
                        <label>Previous Residential Address</label>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="prevFlatNo">Flat No/Building Name:</label>
                                <input type="text" name="prevFlatNo" id="prevFlatNo" placeholder="Enter previous flat number or building name">
                            </div>
                            <div class="form-group">
                                <label for="prevStreetNo">House/Street No.:</label>
                                <input type="text" name="prevStreetNo" id="prevStreetNo" placeholder="Enter previous house or street number">
                            </div>
                            <div class="form-group">
                                <label for="prevTownCity">Town/City:</label>
                                <input type="text" name="prevTownCity" id="prevTownCity" placeholder="Enter previous town or city">
                            </div>
                            <div class="form-group">
                                <label for="prevProvince">Province:</label>
                                <input type="text" name="prevProvince" id="prevProvince" placeholder="Enter previous province">
                            </div>
                            <div class="form-group">
                                <label for="prevPostalCode">Postal Code:</label>
                                <input type="text" name="prevPostalCode" id="prevPostalCode" placeholder="Enter previous postal code">
                            </div>
                            <div class="form-group">
                                <label for="prevCountry">Country:</label>
                                <input type="text" name="prevCountry" id="prevCountry" placeholder="Enter previous country">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========= Step 3: Employment & Bank Details ========= -->
            <div class="section" id="step3">
                <div class="section-header">
                    <h2>Employment &amp; Bank Details</h2>
                </div>
                <!-- Split into Employment Details and Bank Details subsections -->
                <div class="subsection">
                    <h3>Employment Details</h3>
                    <div class="form-group full-width">
                        <label>Source(s) of Funds (select all that apply):</label>
                        <div class="checkbox-group">
                            <div class="checkbox-option">
                                <input type="checkbox" name="fundSource" value="employment" id="employmentCheckbox" onchange="toggleEmploymentDetails()">
                                <label for="employmentCheckbox">Employment</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" name="fundSource" value="pension" id="pensionCheckbox">
                                <label for="pensionCheckbox">Pension</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" name="fundSource" value="inheritance" id="inheritanceCheckbox">
                                <label for="inheritanceCheckbox">Inheritance</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" name="fundSource" value="selfEmployed" id="selfEmployedCheckbox" onchange="toggleSelfEmployedDetails()">
                                <label for="selfEmployedCheckbox">Self-employed</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" name="fundSource" value="savings" id="savingsCheckbox">
                                <label for="savingsCheckbox">Savings &amp; Investments</label>
                            </div>
                            <div class="checkbox-option">
                                <input type="checkbox" name="fundSource" value="other" id="otherFundCheckbox" onchange="toggleOtherFundDetails()">
                                <label for="otherFundCheckbox">Other</label>
                            </div>
                        </div>
                    </div>
                    <div id="employmentDetails" class="form-group full-width" style="display:none;">
                        <label for="employerName">Employer Name:</label>
                        <input type="text" name="employerName" id="employerName" placeholder="Enter your employer name">
                        <label for="jobTitle">Job Title:</label>
                        <input type="text" name="jobTitle" id="jobTitle" placeholder="Enter your job title">
                    </div>
                    <div id="selfEmployedDetails" class="form-group full-width" style="display:none;">
                        <label for="businessName">Business Name:</label>
                        <input type="text" name="businessName" id="businessName" placeholder="Enter your business name">
                        <label for="natureOfBusiness">Nature of Business:</label>
                        <input type="text" name="natureOfBusiness" id="natureOfBusiness" placeholder="Describe your business">
                        <label for="annualTurnover">Estimated Annual Turnover:</label>
                        <input type="number" name="annualTurnover" id="annualTurnover" value="0" placeholder="Enter estimated annual turnover">
                    </div>
                    <div id="otherFundDetails" class="form-group full-width" style="display:none;">
                        <label for="otherFundDetailsText">Other Source Details:</label>
                        <input type="text" name="otherFundDetailsText" id="otherFundDetailsText" placeholder="Enter other source details">
                    </div>
                    <div class="form-group">
                        <label for="monthlyIncome">Monthly Income after Tax <span style="color:red">*</span></label>
                        <input type="number" name="monthlyIncome" id="monthlyIncome" required value="0" placeholder="Enter your monthly income after tax">
                    </div>
                    <div class="form-group">
                        <label for="monthlyOutgoings">Monthly Outgoings <span style="color:red">*</span></label>
                        <input type="number" name="monthlyOutgoings" id="monthlyOutgoings" required value="0" placeholder="Enter your monthly outgoings">
                    </div>
                    <div class="form-group">
                        <label for="savingsValue">Value of Savings &amp; Investments <span style="color:red">*</span></label>
                        <input type="number" name="savingsValue" id="savingsValue" required value="0" placeholder="Enter value of savings & investments">
                    </div>
                    <div class="form-group">
                        <label for="dmaInvestment">Planned Investment with DMA (Next 3 Years) <span style="color:red">*</span></label>
                        <input type="number" name="dmaInvestment" id="dmaInvestment" required value="0" placeholder="Enter planned DMA investment">
                    </div>
                </div>
                <div class="subsection">
                    <h3>Bank Details</h3>
                    <div class="form-group">
                        <label for="account_holder">Account Holder Name <span style="color:red">*</span></label>
                        <input type="text" id="account_holder" name="account_holder" required placeholder="e.g. John Smith">
                    </div>
                    <div class="form-group">
                        <label for="bank_name">Bank Name <span style="color:red">*</span></label>
                        <input type="text" id="bank_name" name="bank_name" required placeholder="e.g. ABC Bank">
                    </div>
                    <div class="form-group">
                        <label for="bank_account_type">Bank Account Type <span style="color:red">*</span></label>
                        <select id="bank_account_type" name="bank_account_type" required>
                            <option value="">-- Please Select --</option>
                            <option value="checking">Checking</option>
                            <option value="savings">Savings</option>
                            <option value="business">Business</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
              
                    <div class="form-group">
                        <label for="account_number">Account Number/IBAN <span style="color:red">*</span></label>
                        <input type="text" id="account_number" name="account_number" required placeholder="e.g. GB29NWBK...">
                    </div>
                    <div class="form-group">
                        <label for="branch_code">Branch/Sort Code <span style="color:red">*</span></label>
                        <input type="text" id="branch_code" name="branch_code" required placeholder="e.g. 60-83-71">
                    </div>
                    <div class="form-group">
                        <label for="swift_code">Swift/BIC Code <span style="color:red">*</span></label>
                        <input type="text" id="swift_code" name="swift_code" required placeholder="e.g. ABCDGB2L">
                    </div>
                    <div class="form-group">
                        <label for="proof_upload">Proof of Bank Account (Upload bank statement or letter showing bank name and account number, in your details) <span style="color:red">*</span></label>
                        <input type="file" id="proof_upload" name="proof_upload" accept=".pdf, image/*" required>
                    </div>
                    <div class="form-group full-width">
                        <p style="color:#555;">Important Notice: DMA does not accept or make 3rd party payments. Third party deposits will be returned.</p>
                    </div>
                </div>
            </div>

            <!-- ========= Step 4: Trading Experience ========= -->
            <div class="section" id="step4">
                <div class="section-header">
                    <h2>Trading Experience</h2>
                </div>
                <div class="form-grid">
                    <div class="form-group">
                        <label>Have you ever traded financial products before? </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="financialProducts" value="yes" id="financialProductsYes" onchange="togglefinancialProducts()" required>
                                <label for="financialProductsYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="financialProducts" value="no" id="financialProductsNo" onchange="togglefinancialProducts()" required>
                                <label for="financialProductsNo">No</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Do you have an industry‐recognised qualification for trading? </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="recognisedQual" value="yes" id="recognisedQualYes" onchange="togglerecognisedQual()" required>
                                <label for="recognisedQualYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="recognisedQual" value="no" id="recognisedQualNo" onchange="togglerecognisedQual()" required>
                                <label for="recognisedQualNo">No</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Have you worked in the financial sector (at least one year)? </label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="hasExperience" value="yes" id="hasExperienceYes" onchange="togglehasExperience()" required>
                                <label for="hasExperiencelYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="hasExperience" value="no" id="hasExperienceNo" onchange="togglehasExperiencel()" required>
                                <label for="hasExperienceNo">No</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Have you ever traded derivative products (CFDs, Futures, Options)?</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="hasderivatives" value="yes" id="hasderivativesYes" onchange="togglehasderivatives()" required>
                                <label for="hasderivativesYes">Yes</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="hasderivatives" value="no" id="hasderivativeseNo" onchange="togglehasderivatives()" required>
                                <label for="hasderivativesNo">No</label>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>How long have you continuously traded financial products?</label>
                        <select id="tradingduration" name="tradingduration">
                            <option value="">-- Select --</option>
                            <option value="less1">Less than 1 year</option>
                            <option value="1-2">1 - 2 years</option>
                            <option value="2-5">2 - 5 years</option>
                            <option value="5-10">5 - 10 years</option>
                            <option value="10plus">More than 10 years</option>
                        </select>
                    </div>
                    <!-- Updated Trading Activity Section -->
                    <div class="form-group full-width">
                        <label>Trading Activity (Last 12 Months)</label>
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="tradefx">FX Rolling Spot:</label>
                                <input type="number" id="tradefx" name="tradefx" value="0" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label for="tradeoptions">Options &amp; Futures:</label>
                                <input type="number" id="tradeoptions" name="tradeoptions" value="0" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label for="tradecfds">CFDs:</label>
                                <input type="number" id="tradecfds" name="tradecfds" value="0" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label for="tradespreads">Financial Spread Bets:</label>
                                <input type="number" id="tradespreads" name="tradespreads" value="0" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label for="tradeshares">Shares &amp; ETF's:</label>
                                <input type="number" id="tradeshares" name="tradeshares" value="0" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label for="trademutualFunds">Mutual Funds:</label>
                                <input type="number" id="trademutualFunds" name="trademutualFunds" value="0" placeholder="Enter amount">
                            </div>
                            <div class="form-group">
                                <label for="tradebonds">Bonds/Gilts:</label>
                                <input type="number" id="tradebonds" name="tradebonds" value="0" placeholder="Enter amount">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========= Step 5: Dividends Tax ========= -->
            <div class="section" id="step5">
                <div class="section-header">
                    <h2>Dividends Tax</h2>
                </div>
                <p class="section-intro" style="text-align: left">
                    Please complete the Dividends Tax form below. South African residents will complete the DTD form, while non–South Africans will complete the W‑8BEN form.
                </p>
                <!-- DTD Form Container (for South African residents) -->
                <div id="dtd-form-container" style="display:none;">
                    <div style="border-radius: 20px; border-style: dotted; border-color: #333; border-width: 1px; padding: 20px; margin-top: 40px;" id="dwt-form">
                        <div class="review-section">
                            <h2 class="section-header2">FORM DTD (EX): Dividends Tax</h2>
                            <p><strong>Declaration &amp; Undertaking for dividend tax exemption.</strong></p>
                            <p><em>Complete if applicable (seek independent tax advice).</em></p>
                            <div style="border:1px solid #fd8f15; padding:10px; margin-bottom:20px;">
                                <p><strong>NOTES ON COMPLETION:</strong></p>
                                <ul>
                                    <li>This form is to be completed by the beneficial owner for tax exemption.</li>
                                    <li>Submission must occur within the required period.</li>
                                    <li><strong>Non-South African residents should not complete this form.</strong></li>
                                </ul>
                            </div>
                            <form id="dividendsTaxForm">
                                <div class="review-section">
                                    <h3 class="section-header2">PART A: Withholding Agent</h3>
                                    <p><em>(Pre-populated)</em></p>
                                    <div class="review-item">
                                        <label for="registeredName" class="review-label">Registered Name:</label><br>
                                        <input type="text" id="registeredName" name="registeredName" value="SCM DMA (Pty) Ltd." readonly>
                                    </div>
                                    <div class="review-item">
                                        <label for="taxReferenceNumber" class="review-label">Dividends tax reference #:</label><br>
                                        <input type="text" id="taxReferenceNumber" name="taxReferenceNumber" value="(pre-populated)" readonly>
                                    </div>
                                    <div class="review-item">
                                        <label for="withholdingAddress" class="review-label">Address:</label><br>
                                        <textarea id="withholdingAddress" name="withholdingAddress" rows="3" readonly>48 7th Ave
Parktown North
Johannesburg
2193</textarea>
                                    </div>
                                    <div class="review-item">
                                        <label for="withholdingTelephone" class="review-label">Telephone #:</label><br>
                                        <input type="text" id="withholdingTelephone" name="withholdingTelephone" value="+27 (0)10 201 6300" readonly>
                                    </div>
                                    <div class="review-item">
                                        <label for="withholdingEmail" class="review-label">E-mail:</label><br>
                                        <input type="text" id="withholdingEmail" name="withholdingEmail" value="applications@dma.co.za" readonly>
                                    </div>
                                </div>
                                <div class="review-section">
                                    <h3 class="section-header2">PART B: Beneficial Owner</h3>
                                    <p><em>(Complete by the dividend recipient)</em></p>
                                    <div class="review-item">
                                        <label for="fullName" class="review-label">Full Name / Registered Name:</label><br>
                                        <input type="text" id="fullName" name="fullName">
                                    </div>
                                    <div class="review-item">
                                        <label for="entityNumber" class="review-label">Entity number (if applicable):</label><br>
                                        <input type="text" id="entityNumber" name="entityNumber">
                                    </div>
                                    <p><strong>Nature of person/entity:</strong></p>
                                    <div style="margin-left:1rem;">
                                        <input type="radio" name="nature" value="individual"><label> Individual</label><br>
                                        <input type="radio" name="nature" value="listedCompany"><label> Listed Company</label><br>
                                        <input type="radio" name="nature" value="unlistedCompany"><label>Unlisted Company</label> <br>
                                        <input type="radio" name="nature" value="trust"><label> Trust</label><br>
                                        <input type="radio" name="nature" value="rsaGovernment"><label> RSA Government</label><br>
                                        <input type="radio" name="nature" value="retirementFund"><label> Retirement Fund</label><br>
                                        <input type="radio" name="nature" value="other"><label> Other</label>
                                    </div>
                                    <div class="review-item">
                                        <label for="otherNature" class="review-label">If 'Other', please specify:</label><br>
                                        <input type="text" id="otherNature" name="otherNature">
                                    </div>
                                    <div class="review-item">
                                        <label for="idNumber" class="review-label">Identity/Passport/Registration #:</label><br>
                                        <input type="text" id="idNumber" name="idNumber">
                                    </div>
                                    <div class="review-item">
                                        <label for="dateOfBirth" class="review-label">Date of Birth/Inception:</label><br>
                                        <input type="date" id="dateOfBirth" name="dateOfBirth">
                                    </div>
                                    <div class="review-item">
                                        <label for="incomeTaxReference" class="review-label">SA Income Tax Reference #:</label><br>
                                        <input type="text" id="incomeTaxReference" name="incomeTaxReference">
                                    </div>
                                    <div class="review-item">
                                        <label for="physicalAddress" class="review-label">Physical Address:</label><br>
                                        <textarea id="physicalAddress" name="physicalAddress" rows="2"></textarea>
                                    </div>
                                    <div class="review-item">
                                        <label for="physicalPostalCode" class="review-label">Postal Code (physical):</label><br>
                                        <input type="text" id="physicalPostalCode" name="physicalPostalCode">
                                    </div>
                                    <div class="review-item">
                                        <label for="postalAddress" class="review-label">Postal Address:</label><br>
                                        <textarea id="postalAddress" name="postalAddress" rows="2"></textarea>
                                    </div>
                                    <div class="review-item">
                                        <label for="postalPostalCode" class="review-label">Postal Code (postal):</label><br>
                                        <input type="text" id="postalPostalCode" name="postalPostalCode">
                                    </div>
                                    <div class="review-item">
                                        <label for="countryTaxResidence" class="review-label">Country of Tax Residency:</label><br>
                                        <input type="text" id="countryTaxResidence" name="countryTaxResidence">
                                    </div>
                                </div>
                                <div class="review-section">
                                    <h3 class="section-header2">PART C: Exemption</h3>
                                    <p>Please select the one reason for dividend tax exemption:</p>
                                    <div style="margin-left:0">
                                        <label> Par (a) – Company resident in SA</label><input type="radio" name="exemptionReason" value="a"><br>
                                        <label>Par (b) – Government/municipality (RSA)</label><input type="radio" name="exemptionReason" value="b"><br>
                                        <label> Par (c) – Public benefit organisation</label><input type="radio" name="exemptionReason" value="c"><br>
                                        <label>Par (d) – Trust in s37A</label><input type="radio" name="exemptionReason" value="d"><br>
                                        <label>Par (e) – Institution in s10(1)(cA)</label><input type="radio" name="exemptionReason" value="e"><br>
                                        <label>Par (f) – Fund in s10(1)(d)(i)/(ii)</label><input type="radio" name="exemptionReason" value="f"><br>
                                        <label>Par (g) – Person in s10(1)(t)</label><input type="radio" name="exemptionReason" value="g"><br>
                                        <label>Par (h) – Micro business shareholder</label><input type="radio" name="exemptionReason" value="h"><br>
                                        <label>Par (i) – Small business funding entity</label><input type="radio" name="exemptionReason" value="i"><br>
                                        <label>Par (j) – Non-resident for foreign dividends<input type="radio" name="exemptionReason" value="j"></label><br>
                                        <label>Par (k) – Portfolio of investment schemes<input type="radio" name="exemptionReason" value="k"></label><br>
                                        <label>Par (l) – Dividend is normal taxable income<input type="radio" name="exemptionReason" value="l"></label><br>
                                        <label>Par (m) – Dividend was subject to STC<input type="radio" name="exemptionReason" value="m"></label><br>
                                        <label>Par (n) – Fidelity/indemnity funds<input type="radio" name="exemptionReason" value="n"></label><br>
                                        <label>Par (w) – REIT dividends or property company<input type="radio" name="exemptionReason" value="o"></label><br>
                                        <label>Par (x) – Other</label><input type="radio" name="exemptionReason" value="x">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- W‑8BEN Form Container (for non-South Africans) -->
                <div id="w8ben-form-container" style="display:none;">
                    <div class="flex-container">
                        <div class="flex-item">
                            <label for="primaryTaxCountry">Country of Primary Tax Residence:</label>
                            <select name="primaryTaxCountry" id="primaryTaxCountry" required>
                                <option value="">Select a country</option>
                                <option value="US">United States</option>
                                <option value="CA">Canada</option>
                            </select>
                        </div>
                        <div class="flex-item">
                            <label for="taxNumber">Tax Number in Primary Country:</label>
                            <input type="text" name="taxNumber" id="taxNumber" required placeholder="Enter your tax number">
                        </div>
                    </div>
                    <div class="flex-container">
                        <div class="flex-item">
                            <label>Are you a tax resident of any other country?</label>
                            <div class="radio-group">
                                <input type="radio" id="hasOtherTaxYes" name="hasOtherTaxResidence" value="yes" required>
                                <label for="hasOtherTaxYes">Yes</label>
                                <input type="radio" id="hasOtherTaxNo" name="hasOtherTaxResidence" value="no" required>
                                <label for="hasOtherTaxNo">No</label>
                            </div>
                        </div>
                    </div>
                    <div id="secondary-tax" style="display:none;">
                        <div class="flex-container">
                            <div class="flex-item">
                                <label for="secondaryTaxCountry">Secondary Tax Country:</label>
                                <select name="secondaryTaxCountry" id="secondaryTaxCountry">
                                    <option value="">Select a country</option>
                                    <option value="US">United States</option>
                                    <option value="CA">Canada</option>
                                </select>
                            </div>
                            <div class="flex-item">
                                <label for="secondaryTaxNumber">Tax Number in Secondary Country:</label>
                                <input type="text" name="secondaryTaxNumber" id="secondaryTaxNumber" placeholder="Enter your secondary tax number">
                            </div>
                        </div>
                    </div>
                    <div class="flex-container">
                        <div class="flex-item">
                            <label>Are you a US citizen?</label>
                            <div class="radio-group">
                                <input type="radio" id="usCitizenYes" name="isUSCitizen" value="yes" required>
                                <label for="usCitizenYes">Yes</label>
                                <input type="radio" id="usCitizenNo" name="isUSCitizen" value="no" required>
                                <label for="usCitizenNo">No</label>
                            </div>
                        </div>
                        <div class="flex-item">
                            <label>Are you a US tax resident?</label>
                            <div class="radio-group">
                                <input type="radio" id="usTaxResidentYes" name="isUSTaxResident" value="yes" required>
                                <label for="usTaxResidentYes">Yes</label>
                                <input type="radio" id="usTaxResidentNo" name="isUSTaxResident" value="no" required>
                                <label for="usTaxResidentNo">No</label>
                            </div>
                        </div>
                    </div>
                    <div style="border-radius: 20px; border-style: dotted; border-color: #333; border-width: 1px; padding: 20px;" id="w8ben-form">
                        <table class="tablecontent" id="Tax_documentation">
                            <tbody>
                                <tr style="border-bottom: thin solid; border-color: #000;">
                                    <td style="width: 16%; border-right: thin solid; border-color: black;">
                                        <div>
                                            <span class="smalltext">Form</span><span style="font-size: 16px;"><b>W-8BEN</b></span>
                                            <p class="smalltext">
                                                (Rev. October 2021)<br><br>Department of the
                                                TreasuryInternal Revenue
                                                Service
                                            </p>
                                        </div>
                                    </td>
                                    <td style="width: 68%;">
                                        <div style="text-align: center;">
                                            <h1 class="largesttext">
                                                Certificate of Foreign Status of Beneficial Owner for United<br>States
                                                Tax Withholding and Reporting (Individuals)
                                            </h1>
                                            <p>
                                                ► For use by individuals. Entities must use Form W-8BEN-E.<br>
                                                ► Go to www.irs.gov/FormW8BEN for instructions and the latest information.<br>
                                                ► Give this form to the withholding agent or payer. Do not send to the IRS.
                                            </p>
                                        </div>
                                    </td>
                                    <td style="width: 16%; border-left: thin solid;">
                                        <h2 style="text-align: right; font-size: 9px;">OMB No. 1545-1621</h2>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <hr style="margin: 2px;color: #000; border-color: #000;">
                        <p style="margin: 2px;">
                            <em class="smalltext" style="padding: 5px;">
                                Note: If you are resident in a FATCA partner jurisdiction (that is, a Model 1 IGA jurisdiction with reciprocity), certain tax account information may be<br>provided to your jurisdiction of residence.
                            </em>
                        </p>
                        <hr style="margin: 2px;color: #000; border-color: #000;">
                        <!-- Part I -->
                        <div style="margin-bottom: 10px;">
                            <table class="w8parti">
                                <tbody>
                                    <tr>
                                        <td style="width: 10%; padding: 2px; background: #000; color:#FFF">
                                            <p style="font-size: 12px; padding: 1px; padding-left: 5px; margin: 1px;">Part I</p>
                                        </td>
                                        <td>
                                            <h2 class="largetext" style="margin: 0; text-align: left; padding-left: 30px;">
                                                Identification of Beneficial Owner <span style="font-weight: 100;">(see instructions)</span>
                                            </h2>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; border-top: thin solid; vertical-align: top;">
                                        <td style="width: 4%;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">1</p>
                                        </td>
                                        <td style="width: 60%; padding: 2px; border-right: thin solid;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                Name of individual who is the beneficial owner<br>{{w8name}}
                                            </p>
                                        </td>
                                        <td style="width: 4%;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">2</p>
                                        </td>
                                        <td>
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                Country of citizenship<br>{{w8citizenship}}
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: top;">
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;"></p>
                                        </td>
                                        <td style="padding: 2px;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                Permanent residence address (street, apt. or suite no., or rural route). <b>Do not use a P.O. box or in-care-of address.</b><br>{{w8address}}
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: top;">
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;"></p>
                                        </td>
                                        <td style="padding: 2px;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                City or town, state or province. Include postal code where appropriate.<br>{{w8cityortown}}
                                            </p>
                                        </td>
                                        <td style="padding: 2px; width: 30%; border-left: thin solid;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                Country<br>{{w8residencecountry}}
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: top;">
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">4</p>
                                        </td>
                                        <td style="padding: 2px;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                Mailing address (if different from above)<br>{{w8mailaddress}}
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: top;">
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;"></p>
                                        </td>
                                        <td style="padding: 2px;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                City or town, state or province. Include postal code where appropriate.<br>{{w8mailcityortown}}
                                            </p>
                                        </td>
                                        <td style="padding: 2px; width: 30%; border-left: thin solid;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                Country<br>{{w8mailcountry}}
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: top;">
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">5</p>
                                        </td>
                                        <td style="padding: 2px;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                U.S. taxpayer identification number (SSN or ITIN), if required (see instructions)<br>{{w8ustax}}
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: top;">
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">6a</p>
                                        </td>
                                        <td style="padding: 2px; width: 46%;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                Foreign tax identifying number (see instructions)<br>{{w8taxno}}
                                            </p>
                                        </td>
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">6b</p>
                                        </td>
                                        <td style="padding: 2px; width: 46%;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                {{w8ftin}}
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: top;">
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">7</p>
                                        </td>
                                        <td style="padding: 2px; width: 46%;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                Reference number(s) (see instructions)<br>{{w8refno}}
                                            </p>
                                        </td>
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">8</p>
                                        </td>
                                        <td style="padding: 2px; width: 46%;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                Date of birth (MM-DD-YYYY) (see instructions)<br>{{w8dob}}
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: middle;">
                                        <td style="width: 10%; padding: 2px; background: #000; color:#FFF">
                                            <p style="font-size: 12px; padding: 1px; padding-left: 5px; margin: 1px;">Part II</p>
                                        </td>
                                        <td>
                                            <h2 class="largetext" style="margin: 0; text-align: left; padding-left: 30px;">
                                                Claim of Tax Treaty Benefits <span style="font-weight: 100;">(for chapter 3 purposes only) (see instructions)</span>
                                            </h2>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: top;">
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">9</p>
                                        </td>
                                        <td style="padding: 2px;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                I certify that the beneficial owner is a resident of <span style="text-decoration: underline;">{{w8residentcountry}}</span> within the meaning of the income tax treaty between the United States and that country.
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: top;">
                                        <td style="width: 4%">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">10</p>
                                        </td>
                                        <td style="padding: 2px;">
                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">
                                                <b>Special rates and conditions</b> (if applicable—see instructions): The beneficial owner is claiming the provisions of Article and paragraph {{w8paragraph}} of the treaty identified on line 9 above to claim a {{w8percentage}}% rate of withholding on (specify type of income):<br>{{w8incometype}}<br>Explain the additional conditions in the Article and paragraph the beneficial owner meets to be eligible for the rate of withholding:<br>{{w8explanation}}
                                            </p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class="w8parti">
                                <tbody>
                                    <tr style="border-bottom: thin solid; vertical-align: middle;">
                                        <td style="width: 10%; padding: 2px; background: #000; color:#FFF">
                                            <p style="font-size: 12px; padding: 1px; padding-left: 5px; margin: 1px;">Part III</p>
                                        </td>
                                        <td>
                                            <h2 class="largetext" style="margin: 0; text-align: left; padding-left: 30px;">Certification</h2>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div>
                            <table>
                                <tbody>
                                    <tr>
                                        <td style="vertical-align: top; padding-top: 65px;">
                                            <h2 class="largetext" style="margin: 0; text-align: left; padding-left: 30px;">Sign here</h2>
                                        </td>
                                        <td style="vertical-align: top; padding-top: 65px;">►</td>
                                        <td>
                                            <table>
                                                <tbody>
                                                    <tr>
                                                        <td colspan="2">
                                                            <p>I certify that I have the capacity to sign for the person identified on line 1 of this form.</p>
                                                        </td>
                                                    </tr>
                                                    <tr style="border-bottom: thin solid;">
                                                        <td>
                                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">{{w8signature}}</p>
                                                        </td>
                                                        <td>
                                                            <p style="font-size: 11px; padding: 1px; margin: 1px;"><span class="american-date"></span></p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">Signature of beneficial owner (or individual authorized to sign for beneficial owner)</p>
                                                        </td>
                                                        <td>
                                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">Date (MM-DD-YYYY)</p>
                                                        </td>
                                                    </tr>
                                                    <tr style="border-bottom: thin solid;">
                                                        <td colspan="2">
                                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">{{w8signatoryname}}</p>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <td colspan="2">
                                                            <p style="font-size: 11px; padding: 1px; margin: 1px;">Print name of signer</p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ========= Step 6: Declarations ========= -->
            <div class="section" id="step6">
                <div class="section-header">
                    <h2>Declarations</h2>
                </div>
                <div class="form-grid">
                    <fieldset>
                        <legend>Data Protection Notice</legend>
                        <p>By signing, you confirm that you have read and agree to DMA's Privacy Notice and consent to the necessary checks.</p>
                    </fieldset>
                    <fieldset>
                        <legend>Terms and Documentation</legend>
                        <p>I confirm that I have obtained and understood the following from <a href="https://www.dma.co.za" target="_blank">www.dma.co.za</a>:</p>
                        <ol>
                            <li>The General Business Terms</li>
                            <li>DMA Privacy Notice</li>
                            <li>Commission, Charges &amp; Margin Schedule</li>
                            <li>Order Execution Policy</li>
                            <li>Conflict of Interest Policy</li>
                            <li>Market Conduct Information</li>
                        </ol>
                        <div class="form-group">
                            <label><input type="checkbox" id="fExecPolicy" name="fExecPolicy"> I consent to the Order Execution Policy.</label>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend>Declarations and Acknowledgements</legend>
                        <div class="form-group">
                            <label><input type="checkbox" id="fReadRisk" name="fReadRisk" style="align-items"> I have read and understood the risks of trading.</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="fOwnFunds" name="fOwnFunds"> All funds deposited are my own.</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="fNoHealthIssues" name="fNoHealthIssues"> I am not aware of any condition affecting my account operation.</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="fAccurateInfo" name="fAccurateInfo"> I have provided true, accurate, and complete information.</label>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="fTaxObligation" name="fTaxObligation"> I accept that DMA may share my info with tax authorities if required.</label>
                        </div>
                    </fieldset>
                    <fieldset>
                        <legend>Signature</legend>
                        <div class="form-group full-width">
                            <label>Please sign below <span style="color:red">*</span></label>
                            <canvas id="signatureCanvas" width="400" height="200" style="border:3px solid #ccc; border-radius:6px;"></canvas>
                            <div class="error-message" id="signatureError" style="display:none;">Please provide your signature.</div>
                        </div>
                        <button type="button" id="clearSignature" class="btn-primary" style="margin-top:10px;">Clear Signature</button>
                        <input type="hidden" id="signatureData" name="signatureData" required>
                    </fieldset>
                </div>
            </div>
        </form>

        <!-- Navigation Buttons -->
        <div class="navigation-buttons">
            <button type="button" id="backButton" class="btn-primary" style="display: none;">Back</button>
            <button type="button" id="nextButton" class="btn-primary">Next</button>
        </div>

        <!-- Completion Screen -->
        <div id="completionScreen">
            <h2>Submission Complete</h2>
            <p class="completionText">We will send you an email shortly. Thank you for taking the time to complete this form 🙂</p>
        </div>
    </div>

    <script>
        /* ========= Multi-Step Navigation ========= */
        const desktopSections = document.querySelectorAll('.section');
        const progressLineActive = document.querySelector('.progress-line-active');
        const stepNumbers = document.querySelectorAll('.step-number');
        const backButton = document.getElementById('backButton');
        const nextButton = document.getElementById('nextButton');
        const formElement = document.getElementById('mergedForm');
        const completionScreen = document.getElementById('completionScreen');
        const progressContainer = document.getElementById('progressContainer');
        let currentStep = 0;

        function showStep(index) {
            desktopSections.forEach((sec, i) => sec.classList.toggle('active', i === index));
            backButton.style.display = (index === 0) ? 'none' : 'inline-block';
            nextButton.textContent = (index === desktopSections.length - 1) ? 'Submit' : 'Next';
            updateProgressBar(index);
            if (index === 4) { toggleDividendsForm(); }
        }

        function updateProgressBar(index) {
            const totalSteps = desktopSections.length;
            const percentage = (index / (totalSteps - 1)) * 100;
            progressLineActive.style.width = percentage + '%';
            stepNumbers.forEach((step, i) => {
                if (i <= index) step.parentElement.classList.add('completed');
                else step.parentElement.classList.remove('completed');
            });
        }

        backButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if (currentStep > 0) {
                currentStep--;
                showStep(currentStep);
            }
        });

        nextButton.addEventListener('click', () => {
            if (!validateAllRequiredInSection()) { return; }
            window.scrollTo({ top: 0, behavior: 'smooth' });
            if (currentStep < desktopSections.length - 1) {
                currentStep++;
                showStep(currentStep);
            } else {
                formElement.style.display = 'none';
                progressContainer.style.display = 'none';
                completionScreen.style.display = 'block';
            }
        });

        function validateInput(input) {
            const err = input.parentElement.querySelector('.error-message');
            if (!input.checkValidity()) {
                input.classList.add('invalid');
                if (err) err.style.display = 'block';
            } else {
                input.classList.remove('invalid');
                if (err) err.style.display = 'none';
            }
        }

        document.querySelectorAll('#mergedForm input, #mergedForm select, #mergedForm textarea').forEach(inp => {
            inp.addEventListener('blur', () => { validateInput(inp); });
        });

        function validateAllRequiredInSection() {
            const activeSection = desktopSections[currentStep];
            const requiredEls = activeSection.querySelectorAll('[required], input[pattern], select[pattern]');
            let allValid = true;
            requiredEls.forEach(el => {
                if (el.offsetParent === null) return;
                if (!el.checkValidity()) {
                    validateInput(el);
                    allValid = false;
                }
            });
            return allValid;
        }

        /* ========= Instructions Page Logic ========= */
        const instructionsPage = document.getElementById('instructionsPage');
        const mainFormContainer = document.getElementById('mainFormContainer');
        const startButton = document.getElementById('startButton');
        startButton.addEventListener('click', () => {
            instructionsPage.style.display = 'none';
            mainFormContainer.style.display = 'block';
            showStep(0);
        });

        /* ========= Toggle Logic for Step 1, etc. ========= */
        function toggleResidency() {
            var residency = document.querySelector('input[name="residency"]:checked').value;
            localStorage.setItem('residency', residency);
            var accountTypeSelect = document.getElementById('accountType');
            accountTypeSelect.innerHTML = '<option value="" disabled selected>Select an option</option>';
            var baseCurrencySelect = document.getElementById('baseCurrencySelect');
            if (residency === 'sa') {
                var optionOnshore = document.createElement('option');
                optionOnshore.value = 'onshore';
                optionOnshore.textContent = 'Onshore Account (ZAR denominated)';
                accountTypeSelect.appendChild(optionOnshore);

                var optionOffshore = document.createElement('option');
                optionOffshore.value = 'offshore';
                optionOffshore.textContent = 'Offshore Account (International)';
                accountTypeSelect.appendChild(optionOffshore);

                var optionBoth = document.createElement('option');
                optionBoth.value = 'both';
                optionBoth.textContent = 'Both Onshore and Offshore accounts';
                accountTypeSelect.appendChild(optionBoth);

                // Previously hidden for SA, now always visible so do nothing here
                baseCurrencySelect.innerHTML = '<option value="" disabled selected>Select an option</option>';
            } else {
                // For foreign residents, keep accountType and baseCurrency enabled.
                accountTypeSelect.disabled = false;
                baseCurrencySelect.disabled = false;
                var optionOffshore2 = document.createElement('option');
                optionOffshore2.value = 'offshore';
                optionOffshore2.textContent = 'Offshore Account (International)';
                accountTypeSelect.appendChild(optionOffshore2);
                baseCurrencySelect.innerHTML = '<option value="" disabled selected>Select an option</option><option value="USD">USD</option><option value="GBP">GBP</option><option value="EUR">EUR</option>';
            }
        }

        function toggleUSCitizen() {
            var radios = document.getElementsByName("usCitizen");
            var usCitizenValue = "";
            for (var i = 0; i < radios.length; i++) {
                if (radios[i].checked) {
                    usCitizenValue = radios[i].value;
                    break;
                }
            }
            localStorage.setItem('usCitizen', usCitizenValue);
            var accountTypeSelect = document.getElementById("accountType");
            var baseCurrencySelect = document.getElementById("baseCurrencySelect");
            var warningMessage = document.getElementById("usCitizenWarning");
            if (usCitizenValue === "yes") {
                warningMessage.innerHTML = "We regret to inform you:<br>Since you are a US tax resident, we cannot accept your application at this time.";
                warningMessage.style.display = "block";
                accountTypeSelect.disabled = true;
                baseCurrencySelect.disabled = true;
            } else {
                warningMessage.style.display = "none";
                accountTypeSelect.disabled = false;
                baseCurrencySelect.disabled = false;
            }
        }

        function toggleAccountType() {
            var accountType = document.getElementById('accountType').value;
            localStorage.setItem('accountType', accountType);
            var baseCurrencySelect = document.getElementById('baseCurrencySelect');
            var residency = localStorage.getItem('residency');
            if (residency === 'sa') {
                baseCurrencySelect.innerHTML = '<option value="" disabled selected>Select an option</option>';
                if (accountType === 'onshore') {
                    var option = document.createElement('option');
                    option.value = 'ZAR';
                    option.textContent = 'ZAR';
                    baseCurrencySelect.appendChild(option);
                    baseCurrencySelect.value = 'ZAR';
                    baseCurrencySelect.disabled = true;
                    document.getElementById('baseCurrencyLabel').innerText = "Main Account Currency";
                } else if (accountType === 'offshore' || accountType === 'both') {
                    var currencies = ['USD', 'GBP', 'EUR'];
                    for (var i = 0; i < currencies.length; i++) {
                        var option = document.createElement('option');
                        option.value = currencies[i];
                        option.textContent = currencies[i];
                        baseCurrencySelect.appendChild(option);
                    }
                    baseCurrencySelect.disabled = false;
                    document.getElementById('baseCurrencyLabel').innerText = "Offshore Account Currency";
                }
            }
        }

        function toggleOtherTitle() {
            const title = document.getElementById('title').value;
            const otherDiv = document.getElementById('otherTitleDiv');
            if (title === 'Other') {
                otherDiv.style.display = 'block';
            } else {
                otherDiv.style.display = 'none';
                document.getElementById('otherTitle').value = '';
            }
            localStorage.setItem('title', title);
        }

        document.addEventListener('DOMContentLoaded', function () {
            const idField = document.getElementById('idNumber');
            if (idField) {
                idField.addEventListener('blur', function () {
                    const residency = localStorage.getItem('residency');
                    if (residency === 'sa') { parseAndSetDOBFromSAID(); }
                });
            }
        });

        function parseAndSetDOBFromSAID() {
            let idNum = document.getElementById('idNumber').value;
            if (idNum.length >= 10) {
                let yy = parseInt(idNum.substring(0, 2));
                let mm = parseInt(idNum.substring(2, 4));
                let dd = parseInt(idNum.substring(4, 6));
                let fullYear = (yy < 23 ? 2000 : 1900) + yy;
                let monthStr = mm.toString().padStart(2, '0');
                let dayStr = dd.toString().padStart(2, '0');
                let isoDate = fullYear + '-' + monthStr + '-' + dayStr;
                document.getElementById('dob').value = isoDate;
            }
        }

        function toggleEmploymentDetails() {
            const checkbox = document.getElementById('employmentCheckbox');
            const details = document.getElementById('employmentDetails');
            if (checkbox && details) {
                details.style.display = checkbox.checked ? 'block' : 'none';
                if (!checkbox.checked) {
                    document.getElementById('employerName').value = '';
                    document.getElementById('jobTitle').value = '';
                }
            }
        }

        function toggleSelfEmployedDetails() {
            const checkbox = document.getElementById('selfEmployedCheckbox');
            const details = document.getElementById('selfEmployedDetails');
            if (checkbox && details) {
                details.style.display = checkbox.checked ? 'block' : 'none';
                if (!checkbox.checked) {
                    document.getElementById('businessName').value = '';
                    document.getElementById('natureOfBusiness').value = '';
                    document.getElementById('annualTurnover').value = '0';
                }
            }
        }

        function toggleOtherFundDetails() {
            const checkbox = document.getElementById('otherFundCheckbox');
            const details = document.getElementById('otherFundDetails');
            if (checkbox && details) {
                details.style.display = checkbox.checked ? 'block' : 'none';
                if (!checkbox.checked) {
                    document.getElementById('otherFundDetailsText').value = '';
                }
            }
        }

        let isDrawing = false, lastX = 0, lastY = 0;
        const signatureCanvas = document.getElementById('signatureCanvas');
        const signatureError = document.getElementById('signatureError');
        const signatureDataInput = document.getElementById('signatureData');
        const clearSignatureBtn = document.getElementById('clearSignature');
        if (signatureCanvas) {
            const ctx = signatureCanvas.getContext('2d');
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.lineCap = 'round';

            signatureCanvas.addEventListener('mousedown', (e) => {
                isDrawing = true;
                [lastX, lastY] = getCanvasCoords(e, signatureCanvas);
            });
            signatureCanvas.addEventListener('mousemove', (e) => {
                if (!isDrawing) return;
                const [x, y] = getCanvasCoords(e, signatureCanvas);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                [lastX, lastY] = [x, y];
            });
            window.addEventListener('mouseup', () => { isDrawing = false; });
            signatureCanvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                if (e.touches.length > 0) {
                    isDrawing = true;
                    [lastX, lastY] = getCanvasCoords(e.touches[0], signatureCanvas);
                }
            });
            signatureCanvas.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (!isDrawing || e.touches.length === 0) return;
                const [x, y] = getCanvasCoords(e.touches[0], signatureCanvas);
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
                ctx.lineTo(x, y);
                ctx.stroke();
                [lastX, lastY] = [x, y];
            });
            signatureCanvas.addEventListener('touchend', () => { isDrawing = false; });
            clearSignatureBtn.addEventListener('click', () => {
                ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
                signatureDataInput.value = '';
            });
        }

        function getCanvasCoords(evt, canvas) {
            const rect = canvas.getBoundingClientRect();
            return [evt.clientX - rect.left, evt.clientY - rect.top];
        }

        function toggleDividendsForm() {
            var residency = localStorage.getItem('residency');
            if (residency === 'sa') {
                document.getElementById('dtd-form-container').style.display = 'block';
                document.getElementById('w8ben-form-container').style.display = 'none';
            } else {
                document.getElementById('dtd-form-container').style.display = 'none';
                document.getElementById('w8ben-form-container').style.display = 'block';
            }
        }

        function toggleAddressDuration() {
            const radios = document.getElementsByName('addressDuration');
            const prevAddressDiv = document.getElementById('previousAddressDiv');
            Array.from(radios).forEach(radio => {
                if (radio.checked) {
                    prevAddressDiv.style.display = (radio.value === 'no') ? 'block' : 'none';
                }
            });
        }

        // ========== Add/Delete Functionality for Extra Countries ==========
        document.getElementById('addCountryBtn').addEventListener('click', function () {
            const container = document.getElementById('countryDropdownContainer');
            const currentItems = container.querySelectorAll('.country-dropdown-item').length;
            if (currentItems < 5) {
                const newDropdown = container.querySelector('.country-select').cloneNode(true);
                newDropdown.value = "";
                const wrapper = document.createElement('div');
                wrapper.className = 'country-dropdown-item';
                wrapper.style.display = 'flex';
                wrapper.style.alignItems = 'center';
                wrapper.style.marginBottom = '5px';
                wrapper.appendChild(newDropdown);
                const deleteBtn = document.createElement('button');
                deleteBtn.type = 'button';
                deleteBtn.className = 'deleteCountryBtn';
                deleteBtn.style.marginLeft = '10px';
                deleteBtn.style.padding = '10px 15px';
                deleteBtn.style.fontSize = '16px';
                deleteBtn.textContent = '–';
                wrapper.appendChild(deleteBtn);
                container.insertBefore(wrapper, document.getElementById('addCountryBtn'));
            } else {
                alert("Maximum of 5 countries allowed.");
            }
        });

        document.getElementById('countryDropdownContainer').addEventListener('click', function (event) {
            if (event.target && event.target.matches('.deleteCountryBtn')) {
                event.target.parentElement.remove();
            }
        });

        // ========== Multiple Nationalities ==========
        function toggleMultipleNationalities() {
            var yesRadio = document.getElementById('multipleNationalitiesYes');
            var container = document.getElementById('multipleNationalitiesContainer');
            if (yesRadio.checked) {
                container.style.display = 'block';
            } else {
                container.style.display = 'none';
                var items = container.querySelectorAll('.nationality-dropdown-item');
                items.forEach(function (item, index) {
                    if (index > 0) {
                        item.remove();
                    } else {
                        item.querySelector('.nationality-select').value = "";
                    }
                });
            }
        }

        document.getElementById('addNationalityBtn').addEventListener('click', function () {
            var container = document.getElementById('multipleNationalitiesContainer');
            var currentItems = container.querySelectorAll('.nationality-dropdown-item').length;
            if (currentItems < 5) {
                var newDropdown = container.querySelector('.nationality-select').cloneNode(true);
                newDropdown.value = "";
                var wrapper = document.createElement('div');
                wrapper.className = 'nationality-dropdown-item';
                wrapper.style.display = 'flex';
                wrapper.style.alignItems = 'center';
                wrapper.style.marginBottom = '5px';
                wrapper.appendChild(newDropdown);
                var deleteBtn = document.createElement('button');
                deleteBtn.type = 'button';
                deleteBtn.className = 'deleteNationalityBtn';
                deleteBtn.style.marginLeft = '10px';
                deleteBtn.style.padding = '10px 15px';
                deleteBtn.style.fontSize = '16px';
                deleteBtn.textContent = '–';
                wrapper.appendChild(deleteBtn);
                container.insertBefore(wrapper, document.getElementById('addNationalityBtn'));
            } else {
                alert("Maximum of 5 nationalities allowed.");
            }
        });

        document.getElementById('multipleNationalitiesContainer').addEventListener('click', function (event) {
            if (event.target && event.target.matches('.deleteNationalityBtn')) {
                event.target.parentElement.remove();
            }
        });

        function init() {
            showStep(currentStep);
        }
        init();
    </script>
</body>
</html>